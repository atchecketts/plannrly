# UAT: Feature 12.7 - Tenant Billing Details

## Test Environment Setup

**Prerequisites:**
- Tenant admin accounts
- Stripe customer data (for pre-population test)
- Various test tax IDs for different countries

**Test URLs:**
- Billing Details: `/settings/billing-details`

---

## Test Cases

### TC-12.7.1: Billing Details Page Loads

**Steps:**
1. Log in as tenant admin
2. Navigate to Settings > Billing Details

**Expected Results:**
- [ ] Page loads without errors
- [ ] Form fields displayed
- [ ] Current values shown (if any)
- [ ] Save button visible

---

### TC-12.7.2: Empty Form for New Tenant

**Steps:**
1. Log in as new tenant without billing details
2. Navigate to billing details page

**Expected Results:**
- [ ] Form fields empty
- [ ] Clear labels for each field
- [ ] Required fields indicated
- [ ] Help text where appropriate

---

### TC-12.7.3: Save Billing Details Successfully

**Steps:**
1. Navigate to billing details
2. Fill in all required fields:
   - Legal Name: "Test Company Ltd"
   - Billing Email: "billing@test.com"
   - Address Line 1: "123 Test Street"
   - City: "Test City"
   - Postal Code: "12345"
   - Country: "United States"
3. Save

**Expected Results:**
- [ ] Details saved successfully
- [ ] Success message displayed
- [ ] Values persist on refresh
- [ ] Stored in database correctly

---

### TC-12.7.4: Required Field Validation

**Steps:**
1. Navigate to billing details
2. Leave Legal Name empty
3. Leave Billing Email empty
4. Try to save

**Expected Results:**
- [ ] Validation errors shown
- [ ] Legal Name required error
- [ ] Billing Email required error
- [ ] Form not saved

---

### TC-12.7.5: Tax ID with Type

**Steps:**
1. Navigate to billing details
2. Enter Tax ID: "ESB42691550"
3. Select Tax ID Type: "VAT"
4. Save

**Expected Results:**
- [ ] Tax ID saved
- [ ] Tax ID Type saved
- [ ] Fields display correctly on refresh
- [ ] Proper format stored

---

### TC-12.7.6: Tax ID Format Validation - Valid Spanish VAT

**Steps:**
1. Set Country to Spain
2. Enter Tax ID: "ESB42691550"
3. Select Type: VAT
4. Save

**Expected Results:**
- [ ] Validation passes
- [ ] Tax ID saved
- [ ] Format recognized as valid

---

### TC-12.7.7: Tax ID Format Validation - Invalid Format

**Steps:**
1. Set Country to Spain
2. Enter Tax ID: "INVALID123"
3. Select Type: VAT
4. Try to save

**Expected Results:**
- [ ] Validation error shown
- [ ] Error explains correct format
- [ ] Form not saved
- [ ] Can correct and retry

---

### TC-12.7.8: Complete Address Entry

**Steps:**
1. Navigate to billing details
2. Fill address fields:
   - Line 1: "123 Main St"
   - Line 2: "Suite 400"
   - City: "London"
   - State/Province: "Greater London"
   - Postal Code: "EC1A 1BB"
   - Country: "United Kingdom"
3. Save

**Expected Results:**
- [ ] All address fields saved
- [ ] Optional fields can be empty
- [ ] Address displays correctly
- [ ] Country code stored (GB)

---

### TC-12.7.9: Tax Exempt Status

**Steps:**
1. Navigate to billing details
2. Check "Tax Exempt" checkbox
3. Upload exemption certificate (if required)
4. Save

**Expected Results:**
- [ ] Tax exempt status saved
- [ ] Certificate field shown when exempt
- [ ] Exempt status affects invoicing
- [ ] Clear indication of status

---

### TC-12.7.10: Pre-Populate from Stripe

**Steps:**
1. Have tenant with Stripe customer data
2. Navigate to billing details (empty)
3. Check if pre-populated

**Expected Results:**
- [ ] Name from Stripe customer shown
- [ ] Email from Stripe shown
- [ ] Address fields populated (if in Stripe)
- [ ] Can edit and save

---

### TC-12.7.11: Currency Selection

**Steps:**
1. Navigate to billing details
2. Select Currency: EUR
3. Save

**Expected Results:**
- [ ] Currency saved
- [ ] Affects future invoices
- [ ] Dropdown has common currencies

---

### TC-12.7.12: Invoice Notes Field

**Steps:**
1. Navigate to billing details
2. Enter invoice notes: "Please include PO# on all invoices"
3. Save

**Expected Results:**
- [ ] Notes saved
- [ ] Notes field is optional
- [ ] Text area adequate size
- [ ] Notes appear on invoices

---

### TC-12.7.13: Update Existing Details

**Steps:**
1. Have existing billing details
2. Update legal name
3. Update address
4. Save

**Expected Results:**
- [ ] Changes saved
- [ ] Old values replaced
- [ ] Success message shown
- [ ] No duplicate records

---

### TC-12.7.14: Billing Details Required for Invoices

**Steps:**
1. Try to generate invoice without billing details
2. Observe behavior

**Expected Results:**
- [ ] Error or prompt to complete billing details
- [ ] Link to billing details page
- [ ] Cannot generate invoice without details

---

## Notes

- Test with various country tax ID formats
- Verify country dropdown has all countries
- Check that billing details sync with Stripe customer (if applicable)
- Test on mobile for form usability
- Verify all data persists correctly in database
