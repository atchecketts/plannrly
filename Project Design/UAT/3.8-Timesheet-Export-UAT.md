# UAT: Feature 3.8 - Timesheet Export

## Prerequisites
- User has clock-in/out feature enabled
- Time entries exist for the test period
- Test as both Admin and Employee roles

---

## Test Case 3.8.1: Admin Export Detailed CSV

**Steps:**
1. Log in as Admin
2. Navigate to Timesheets page
3. Ensure time entries exist for the current week
4. Click the "Export" dropdown button
5. Select "Detailed CSV"

**Expected Results:**
- CSV file downloads automatically
- Filename follows pattern: `timesheet-YYYY-MM-DD-to-YYYY-MM-DD.csv`
- CSV contains headers: Employee Name, Employee Email, Date, Scheduled Start, Scheduled End, Actual Start, Actual End, Scheduled Hours, Actual Hours, Variance (minutes), Break Time (minutes), Department, Location, Role, Status, Approved By, Approved At, Notes
- All time entries for the week are included
- Data is properly formatted

---

## Test Case 3.8.2: Admin Export Payroll CSV

**Steps:**
1. Log in as Admin
2. Navigate to Timesheets page
3. Click the "Export" dropdown button
4. Select "Payroll CSV"

**Expected Results:**
- CSV file downloads automatically
- Filename follows pattern: `payroll-YYYY-MM-DD-to-YYYY-MM-DD.csv`
- CSV contains headers: Employee ID, Employee Name, Date, Hours Worked, Overtime Hours, Break Hours, Status
- Simplified format suitable for payroll systems
- Hours are properly calculated

---

## Test Case 3.8.3: Admin Export with Filters

**Steps:**
1. Log in as Admin
2. Navigate to Timesheets page
3. Apply filter by Department
4. Click Export > Detailed CSV

**Expected Results:**
- Only time entries from the selected department are exported
- Other department entries are excluded

---

## Test Case 3.8.4: Employee Export Own Timesheet

**Steps:**
1. Log in as Employee
2. Navigate to My Timesheet page
3. Click the "Export CSV" button

**Expected Results:**
- CSV file downloads
- Contains only the logged-in employee's time entries
- Other employees' data is not included

---

## Test Case 3.8.5: Employee Cannot Export Payroll

**Steps:**
1. Log in as Employee
2. Attempt to access /timesheets/export/payroll directly via URL

**Expected Results:**
- 403 Forbidden response
- Employee cannot access payroll export

---

## Test Case 3.8.6: Export Empty Week

**Steps:**
1. Log in as Admin
2. Navigate to a week with no time entries
3. Click Export > Detailed CSV

**Expected Results:**
- CSV file downloads
- Contains only header row
- No data rows (empty export)

---

## Test Case 3.8.7: Week Navigation and Export

**Steps:**
1. Log in as Admin
2. Navigate to Timesheets page
3. Use Previous/Next week navigation
4. Export the selected week

**Expected Results:**
- Export reflects the currently viewed week
- Filename dates match the selected week
- Data corresponds to the selected week

---

## Test Case 3.8.8: Export Preserves Current Filters

**Steps:**
1. Log in as Admin
2. Apply filters: specific employee + specific department
3. Click Export

**Expected Results:**
- Export URL includes the filter parameters
- Downloaded CSV only contains filtered data

---

## Test Case 3.8.9: Tenant Isolation

**Steps:**
1. Create time entries in Tenant A
2. Create time entries in Tenant B
3. Log in as Admin of Tenant A
4. Export timesheets

**Expected Results:**
- Export contains only Tenant A data
- Tenant B data is not visible or exported

---

## Test Case 3.8.10: CSV Data Integrity

**Steps:**
1. Create a time entry with:
   - Notes containing commas and quotes
   - Special characters in employee name
2. Export to CSV
3. Open CSV in spreadsheet application

**Expected Results:**
- CSV properly escapes special characters
- Data opens correctly in Excel/Google Sheets
- All columns align properly
