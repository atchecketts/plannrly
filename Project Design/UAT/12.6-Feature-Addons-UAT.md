# UAT: Feature 12.6 - Feature Add-on Purchases

## Test Environment Setup

**Prerequisites:**
- Stripe test mode configured
- Add-on products/prices created in Stripe
- Tenant with active base subscription
- Add-on price IDs configured in app

**Test URLs:**
- Add-on Marketplace: `/subscription/addons`

---

## Test Cases

### TC-12.6.1: Add-on Marketplace Page Loads

**Steps:**
1. Log in as tenant with active subscription
2. Navigate to add-ons page

**Expected Results:**
- [ ] Page loads without errors
- [ ] Available add-ons displayed
- [ ] Each add-on shows name and description
- [ ] Prices displayed

---

### TC-12.6.2: Add-on List Display

**Steps:**
1. Navigate to add-ons page
2. Review available add-ons

**Expected Results:**
- [ ] Advanced Analytics add-on shown
- [ ] Geofencing add-on shown
- [ ] Other configured add-ons shown
- [ ] Clear descriptions
- [ ] Purchase buttons visible

---

### TC-12.6.3: Purchase Add-on Successfully

**Steps:**
1. Navigate to add-ons page
2. Click "Add" on Advanced Analytics
3. Confirm purchase

**Expected Results:**
- [ ] Add-on added to subscription
- [ ] Proration calculated
- [ ] Feature immediately enabled
- [ ] Success message shown
- [ ] Add-on shows as "Active"

---

### TC-12.6.4: Add-on Requires Base Subscription

**Steps:**
1. Log in as tenant without subscription
2. Navigate to add-ons page
3. Try to purchase an add-on

**Expected Results:**
- [ ] Error message shown
- [ ] Explains subscription required
- [ ] Link to subscribe
- [ ] Cannot proceed without base subscription

---

### TC-12.6.5: Remove Add-on

**Steps:**
1. Have an active add-on
2. Click "Remove" on the add-on
3. Confirm removal

**Expected Results:**
- [ ] Add-on removed from subscription
- [ ] Feature disabled immediately
- [ ] Billing stops for add-on
- [ ] Success message shown

---

### TC-12.6.6: Add-on Proration

**Steps:**
1. Purchase add-on mid-billing cycle
2. Check invoice/upcoming charges

**Expected Results:**
- [ ] Prorated amount charged
- [ ] Calculation is fair (partial month)
- [ ] Matches Stripe proration
- [ ] Clear in invoice

---

### TC-12.6.7: Feature Gate Enabled on Purchase

**Steps:**
1. Purchase Advanced Analytics add-on
2. Navigate to feature in app

**Expected Results:**
- [ ] Feature now accessible
- [ ] No "upgrade" prompts
- [ ] Feature works correctly
- [ ] Immediate access (no delay)

---

### TC-12.6.8: Feature Gate Disabled on Removal

**Steps:**
1. Remove an add-on
2. Navigate to that feature

**Expected Results:**
- [ ] Feature no longer accessible
- [ ] "Upgrade" or "Add-on required" message
- [ ] Graceful handling
- [ ] Data preserved (just locked)

---

### TC-12.6.9: Active Add-ons Displayed

**Steps:**
1. Navigate to subscription page
2. Check active add-ons section

**Expected Results:**
- [ ] All active add-ons listed
- [ ] Each shows name and price
- [ ] Option to remove each
- [ ] Clear what's included

---

### TC-12.6.10: Multiple Add-ons

**Steps:**
1. Purchase two different add-ons
2. Check subscription details

**Expected Results:**
- [ ] Both add-ons active
- [ ] Both billed correctly
- [ ] Both features enabled
- [ ] Both shown in active list

---

### TC-12.6.11: Add-on with Cancelled Subscription

**Steps:**
1. Have subscription with add-ons
2. Cancel the base subscription
3. Check add-on status

**Expected Results:**
- [ ] Add-ons also cancelled/removed
- [ ] Features disabled at period end
- [ ] Clear messaging
- [ ] Can re-subscribe to regain

---

### TC-12.6.12: Add-on Price Display

**Steps:**
1. Navigate to add-ons page
2. Check price formatting

**Expected Results:**
- [ ] Prices clearly displayed
- [ ] Currency shown
- [ ] Per-month billing indicated
- [ ] Prorated note if applicable

---

## Notes

- Test with multiple add-ons simultaneously
- Verify Stripe subscription items updated correctly
- Check that proration matches Stripe calculations
- Test feature gates immediately after purchase/removal
- Verify add-on webhooks processed correctly
