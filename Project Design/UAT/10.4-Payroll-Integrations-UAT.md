# UAT: Feature 10.4 - Payroll Integrations (Premium)

## Test Environment Setup

**Prerequisites:**
- Admin user with premium subscription
- Test/sandbox accounts for payroll providers (if available)
- Historical timesheet data for export
- Pay period configured

**Test URL:** `/payroll`, `/payroll/setup`, `/payroll/export`

---

## Test Cases

### TC-10.4.1: Feature Gate - Premium Required

**Steps:**
1. Log in as admin without premium subscription
2. Try to access payroll integrations

**Expected Results:**
- [ ] Access denied or upgrade prompt shown
- [ ] Feature marked as premium
- [ ] Manual time export may still work

---

### TC-10.4.2: View Payroll Integration Options

**Steps:**
1. Log in as admin with premium
2. Navigate to Payroll Integrations
3. View available providers

**Expected Results:**
- [ ] Page loads successfully
- [ ] Shows supported providers:
  - ADP
  - Paychex
  - Gusto
  - QuickBooks
  - Xero
- [ ] Setup option for each provider

---

### TC-10.4.3: Setup Integration - OAuth Flow

**Steps:**
1. Click Setup for a provider (e.g., Gusto)
2. Follow OAuth authorization
3. Complete connection

**Expected Results:**
- [ ] Redirects to provider login
- [ ] Authorization permission screen shown
- [ ] Returns to Plannrly after auth
- [ ] Connection status shows "Connected"

---

### TC-10.4.4: Setup Integration - API Key

**Steps:**
1. Click Setup for provider using API key
2. Enter API credentials
3. Test connection
4. Save

**Expected Results:**
- [ ] Form for API key/secret entry
- [ ] Test connection button works
- [ ] Success/failure message shown
- [ ] Credentials saved securely

---

### TC-10.4.5: View Connected Integration

**Steps:**
1. After connecting an integration
2. View integration status

**Expected Results:**
- [ ] Shows connected provider name
- [ ] Last sync timestamp
- [ ] Status indicator (healthy/error)
- [ ] Disconnect option available

---

### TC-10.4.6: Export Wizard - Select Period

**Steps:**
1. Navigate to Payroll Export
2. Select pay period dates
3. Continue to next step

**Expected Results:**
- [ ] Date range selector available
- [ ] Pre-configured pay periods shown
- [ ] Custom date range option
- [ ] Selected period shown clearly

---

### TC-10.4.7: Export Wizard - Review Data

**Steps:**
1. In export wizard, advance to review step
2. Review employees and hours

**Expected Results:**
- [ ] Lists employees in export
- [ ] Shows hours per employee
- [ ] Shows overtime calculations
- [ ] Can exclude specific employees

---

### TC-10.4.8: Export to CSV

**Steps:**
1. Complete export wizard
2. Select CSV export format
3. Download file

**Expected Results:**
- [ ] CSV file generates
- [ ] Format matches provider requirements
- [ ] Headers and data correct
- [ ] Can import to provider manually

---

### TC-10.4.9: Export via API

**Steps:**
1. With connected provider
2. Complete export wizard
3. Select "Send to [Provider]" option
4. Execute export

**Expected Results:**
- [ ] Data sent to provider API
- [ ] Progress indicator shown
- [ ] Success confirmation displayed
- [ ] Can verify in provider system

---

### TC-10.4.10: Export History

**Steps:**
1. Navigate to export history
2. View past exports

**Expected Results:**
- [ ] List of previous exports shown
- [ ] Date, period, and status for each
- [ ] Can download previous exports
- [ ] Shows any errors that occurred

---

### TC-10.4.11: Handle Export Errors

**Steps:**
1. Attempt export with missing data
2. Or simulate API error
3. Observe error handling

**Expected Results:**
- [ ] Clear error message shown
- [ ] Identifies problem (missing data, API error)
- [ ] Can retry after fixing issue
- [ ] Error logged in history

---

### TC-10.4.12: Disconnect Integration

**Steps:**
1. Go to connected integration
2. Click Disconnect
3. Confirm action

**Expected Results:**
- [ ] Confirmation prompt shown
- [ ] Integration removed after confirmation
- [ ] Provider shows as available to reconnect
- [ ] Export history preserved

---

### TC-10.4.13: Employee Mapping

**Steps:**
1. After connecting provider
2. View employee mapping screen
3. Match Plannrly employees to provider employees

**Expected Results:**
- [ ] Shows Plannrly employees
- [ ] Shows provider employees
- [ ] Can match employees
- [ ] Handles unmatched employees gracefully

---

## Notes

- Record any bugs or issues found during testing
- Note the browser and device used for testing
- Screenshot any unexpected behavior
- Use sandbox/test accounts for provider testing
- Document supported export formats per provider
