# UAT: Feature 9.4 - Mobile API Endpoints

## Test Environment Setup

**Prerequisites:**
- Admin and employee user accounts
- API testing tool (Postman, curl, or browser dev tools)
- Valid authentication token
- Published shifts and schedule data

**Test URL:** `/api/mobile/*`

---

## Test Cases

### TC-9.4.1: Mobile Today Endpoint

**Steps:**
1. Authenticate and obtain API token
2. Call GET `/api/mobile/schedule/today`
3. Examine response

**Expected Results:**
- [ ] Returns 200 OK
- [ ] Contains today's shifts for authenticated user
- [ ] Response includes shift time, location, role
- [ ] Lightweight payload (minimal data)

---

### TC-9.4.2: Mobile Week Schedule Endpoint

**Steps:**
1. Authenticate and obtain API token
2. Call GET `/api/mobile/schedule/week`
3. Examine response

**Expected Results:**
- [ ] Returns 200 OK
- [ ] Contains 7 days of shifts
- [ ] Grouped by day for easy display
- [ ] Includes all relevant shift details

---

### TC-9.4.3: Mobile Clock In Endpoint

**Steps:**
1. Authenticate as employee
2. Call POST `/api/mobile/clock/in`
3. Include current timestamp

**Expected Results:**
- [ ] Returns 200/201 on success
- [ ] Clock event is recorded
- [ ] Response includes clock-in time
- [ ] Subsequent check shows clocked-in status

---

### TC-9.4.4: Mobile Clock Out Endpoint

**Steps:**
1. Authenticate as employee (currently clocked in)
2. Call POST `/api/mobile/clock/out`
3. Include current timestamp

**Expected Results:**
- [ ] Returns 200 on success
- [ ] Clock event is recorded
- [ ] Response includes clock-out time and duration
- [ ] Status shows clocked out

---

### TC-9.4.5: Offline Sync Batch Endpoint

**Steps:**
1. Authenticate as employee
2. Call POST `/api/mobile/sync/batch` with multiple actions:
   ```json
   {
     "actions": [
       {"type": "clock_in", "timestamp": "..."},
       {"type": "clock_out", "timestamp": "..."}
     ]
   }
   ```
3. Examine response

**Expected Results:**
- [ ] Returns 200 OK
- [ ] All actions processed
- [ ] Response includes result for each action
- [ ] Failed actions indicate error reason

---

### TC-9.4.6: Initial Sync Endpoint

**Steps:**
1. Authenticate as employee
2. Call GET `/api/mobile/sync/initial`
3. Examine response

**Expected Results:**
- [ ] Returns 200 OK
- [ ] Contains user profile data
- [ ] Contains schedule for offline caching (14 days)
- [ ] Contains notification preferences
- [ ] Response is optimized for size

---

### TC-9.4.7: Unread Notifications Count

**Steps:**
1. Authenticate as employee
2. Call GET `/api/mobile/notifications/unread-count`
3. Examine response

**Expected Results:**
- [ ] Returns 200 OK
- [ ] Contains unread count number
- [ ] Updates after marking notifications read

---

### TC-9.4.8: Mobile Shift Resource Format

**Steps:**
1. Call any endpoint returning shift data
2. Examine shift object structure

**Expected Results:**
- [ ] Shift contains: id, date, start_time, end_time
- [ ] Includes location name (not full object)
- [ ] Includes role name (not full object)
- [ ] Excludes unnecessary nested data
- [ ] Response is under target payload size

---

### TC-9.4.9: Response Caching Headers

**Steps:**
1. Call GET endpoint (e.g., `/api/mobile/schedule/week`)
2. Examine response headers

**Expected Results:**
- [ ] Cache-Control header present
- [ ] ETag or Last-Modified header present
- [ ] Appropriate max-age set for data type

---

### TC-9.4.10: API Error Handling

**Steps:**
1. Call endpoint with invalid data
2. Call endpoint without authentication
3. Call endpoint for non-existent resource

**Expected Results:**
- [ ] Returns appropriate HTTP status codes (400, 401, 404)
- [ ] Error response includes message
- [ ] Error format is consistent
- [ ] No stack traces exposed

---

### TC-9.4.11: API Rate Limiting

**Steps:**
1. Make many rapid API requests
2. Observe rate limiting behavior

**Expected Results:**
- [ ] Rate limit headers present (X-RateLimit-*)
- [ ] 429 status returned when limit exceeded
- [ ] Retry-After header indicates wait time

---

### TC-9.4.12: API Authentication

**Steps:**
1. Call API without token
2. Call API with invalid token
3. Call API with expired token

**Expected Results:**
- [ ] Returns 401 Unauthorized for missing token
- [ ] Returns 401 for invalid token
- [ ] Returns 401 for expired token
- [ ] Clear error message in response

---

## Notes

- Record any bugs or issues found during testing
- Note the browser and device used for testing
- Screenshot any unexpected behavior
- Document actual payload sizes for optimization review
