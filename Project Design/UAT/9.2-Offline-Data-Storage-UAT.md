# UAT: Feature 9.2 - Offline Data Storage

## Test Environment Setup

**Prerequisites:**
- Employee and admin user accounts
- Mobile device or browser with network throttling capability
- Published shifts for the next 14 days
- Clock-in/out functionality available

**Test URL:** `/dashboard`, `/schedule`

---

## Test Cases

### TC-9.2.1: Online/Offline Status Indicator

**Steps:**
1. Log in to the application
2. Observe the UI for online status
3. Disable network (airplane mode or disconnect)
4. Observe UI change

**Expected Results:**
- [ ] Online status indicator is visible
- [ ] Status changes to "offline" when network lost
- [ ] Status changes back to "online" when reconnected
- [ ] Indicator is clearly visible on mobile

---

### TC-9.2.2: Schedule Cached for Offline Viewing

**Steps:**
1. Log in as an employee
2. View schedule for the next 2 weeks
3. Go offline
4. Navigate to schedule page

**Expected Results:**
- [ ] Schedule displays when offline
- [ ] Shows shifts for the cached period (14 days)
- [ ] Shift details are readable
- [ ] No error messages for cached data

---

### TC-9.2.3: User Profile Available Offline

**Steps:**
1. Log in and view your profile
2. Go offline
3. Access profile/settings page

**Expected Results:**
- [ ] Profile information displays from cache
- [ ] User name and preferences are visible
- [ ] No broken avatar images

---

### TC-9.2.4: Queue Clock Event While Offline

**Steps:**
1. Log in as an employee
2. Go offline
3. Attempt to clock in

**Expected Results:**
- [ ] Clock-in action is queued (not rejected)
- [ ] Visual indication that action is pending sync
- [ ] Success message indicates pending sync
- [ ] Clock-in time recorded locally

---

### TC-9.2.5: Sync Queued Actions When Online

**Steps:**
1. Complete TC-9.2.4 (queue offline clock-in)
2. Reconnect to network
3. Observe sync behavior

**Expected Results:**
- [ ] Automatic sync starts when online
- [ ] Sync status indicator shows progress
- [ ] Queued clock event is sent to server
- [ ] Local data updates with server response
- [ ] Success confirmation displayed

---

### TC-9.2.6: Multiple Offline Actions Sync

**Steps:**
1. While offline, perform multiple actions:
   - Clock in
   - Wait 5 minutes
   - Clock out
2. Reconnect to network

**Expected Results:**
- [ ] All actions are queued in order
- [ ] All actions sync in correct order
- [ ] No actions are lost
- [ ] Final state matches expected outcome

---

### TC-9.2.7: Conflict Resolution - Simple

**Steps:**
1. Log in on Device A
2. Go offline on Device A
3. Clock in on Device A (offline)
4. Log in on Device B (online) and clock in
5. Reconnect Device A

**Expected Results:**
- [ ] Conflict is detected
- [ ] User is notified of conflict
- [ ] Conflict resolution options presented OR
- [ ] Server timestamp takes precedence (documented behavior)

---

### TC-9.2.8: IndexedDB Storage Verification

**Steps:**
1. Log in and navigate through the app
2. Open browser dev tools
3. Go to Application > IndexedDB

**Expected Results:**
- [ ] Plannrly database exists
- [ ] Shifts object store contains cached shifts
- [ ] Pending actions store contains any queued actions
- [ ] User preferences are stored

---

### TC-9.2.9: Cache Expiry for Old Data

**Steps:**
1. Cache schedule data
2. Wait or modify system to simulate time passing
3. Check IndexedDB for old entries

**Expected Results:**
- [ ] Data older than 14 days is cleaned up
- [ ] Recent data is preserved
- [ ] Storage doesn't grow unbounded

---

### TC-9.2.10: Offline Action Queue Persistence

**Steps:**
1. Go offline
2. Clock in (queued action)
3. Close the browser completely
4. Reopen browser while still offline
5. Reconnect to network

**Expected Results:**
- [ ] Queued action persists across browser restart
- [ ] Action syncs when online
- [ ] No data loss from closing browser

---

### TC-9.2.11: Sync Status Display

**Steps:**
1. Queue several actions offline
2. Reconnect to network
3. Observe sync status display

**Expected Results:**
- [ ] Sync progress indicator visible
- [ ] Shows number of pending items (e.g., "Syncing 3 actions...")
- [ ] Completes with success message
- [ ] Errors are shown if any action fails

---

### TC-9.2.12: Graceful Degradation of Unavailable Features

**Steps:**
1. Go offline
2. Try to access features requiring live data:
   - Create new leave request
   - Request shift swap

**Expected Results:**
- [ ] Feature shows clear "requires network" message
- [ ] No JavaScript errors
- [ ] User can navigate back to available features
- [ ] Cached features remain accessible

---

## Notes

- Record any bugs or issues found during testing
- Note the browser and device used for testing
- Screenshot any unexpected behavior
- Test IndexedDB limits with various browsers
