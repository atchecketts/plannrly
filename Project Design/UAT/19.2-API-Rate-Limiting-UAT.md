# UAT: Feature 19.2 - API Rate Limiting

## Test Environment Setup

**Prerequisites:**
- API keys/tokens for different subscription tiers
- Access to API endpoints
- Ability to make rapid API requests (via script or tool like Postman)
- Admin user with access to usage dashboard

**Test URL:** `/settings/api-usage`

---

## Test Cases

### TC-19.2.1: View API Usage Dashboard

**Steps:**
1. Log in as an admin
2. Navigate to Settings > API Usage

**Expected Results:**
- [ ] Dashboard loads successfully
- [ ] Shows current usage count
- [ ] Shows rate limit for current subscription tier
- [ ] Shows usage reset period/time
- [ ] Historical usage graph is displayed

---

### TC-19.2.2: Rate Limit Headers in API Response

**Steps:**
1. Make an API request with valid authentication
2. Inspect the response headers

**Expected Results:**
- [ ] Response includes X-RateLimit-Limit header
- [ ] Response includes X-RateLimit-Remaining header
- [ ] Response includes X-RateLimit-Reset header
- [ ] Values are accurate for the subscription tier

---

### TC-19.2.3: Rate Limit Enforcement - Basic Tier

**Steps:**
1. Use API credentials for a basic tier subscription
2. Make requests up to the rate limit
3. Make one additional request beyond the limit

**Expected Results:**
- [ ] Requests within limit succeed (200 OK)
- [ ] Request exceeding limit returns 429 Too Many Requests
- [ ] Response includes Retry-After header
- [ ] Error message is clear and helpful

---

### TC-19.2.4: Rate Limit Enforcement - Premium Tier

**Steps:**
1. Use API credentials for a premium tier subscription
2. Verify higher rate limit is applied
3. Make requests up to the premium limit

**Expected Results:**
- [ ] Premium tier has higher limit than basic
- [ ] X-RateLimit-Limit reflects premium tier limit
- [ ] Premium users can make more requests

---

### TC-19.2.5: Rate Limit Reset

**Steps:**
1. Exhaust the rate limit for a test account
2. Wait for the rate limit reset period
3. Make another API request

**Expected Results:**
- [ ] After reset period, requests succeed again
- [ ] X-RateLimit-Remaining is restored
- [ ] X-RateLimit-Reset shows next reset time

---

### TC-19.2.6: Burst Request Handling

**Steps:**
1. Configure or identify burst allowance settings
2. Make a burst of requests exceeding normal per-second limit
3. Verify burst is allowed within burst capacity

**Expected Results:**
- [ ] Burst requests within burst capacity succeed
- [ ] After burst capacity exhausted, rate limiting kicks in
- [ ] Burst capacity regenerates over time

---

### TC-19.2.7: Approaching Limit Email Alert

**Steps:**
1. Configure alert threshold (e.g., 80% of limit)
2. Make API requests to reach the threshold
3. Check admin email inbox

**Expected Results:**
- [ ] Email alert is sent when threshold is reached
- [ ] Email includes current usage and limit
- [ ] Email suggests upgrading or optimizing usage
- [ ] Alert is sent only once per period (not repeatedly)

---

### TC-19.2.8: Limit Exceeded Email Alert

**Steps:**
1. Exhaust the rate limit completely
2. Check admin email inbox

**Expected Results:**
- [ ] Email alert is sent when limit is exceeded
- [ ] Email explains the situation and retry timing
- [ ] Includes link to upgrade subscription

---

### TC-19.2.9: Different Endpoints Same Limit

**Steps:**
1. Make requests to various API endpoints
2. Verify rate limit is shared across endpoints

**Expected Results:**
- [ ] All API endpoints count toward the same limit
- [ ] Or if per-endpoint limits exist, they are documented
- [ ] X-RateLimit-Remaining decreases regardless of endpoint

---

### TC-19.2.10: Rate Limit Documentation Access

**Steps:**
1. Navigate to API documentation
2. Find rate limiting section

**Expected Results:**
- [ ] Rate limits are clearly documented
- [ ] Different tier limits are listed
- [ ] Headers are explained
- [ ] Best practices for handling 429 errors included

---

### TC-19.2.11: Unauthenticated Request Rate Limiting

**Steps:**
1. Make API requests without authentication
2. Check for rate limiting behavior

**Expected Results:**
- [ ] Unauthenticated requests have their own rate limit
- [ ] Limit is lower than authenticated requests
- [ ] 429 response when exceeded
- [ ] IP-based or other identifier for tracking

---

### TC-19.2.12: Rate Limit Per Tenant vs Per Token

**Steps:**
1. Create multiple API tokens for same tenant
2. Make requests with different tokens
3. Verify limit sharing behavior

**Expected Results:**
- [ ] Rate limit is shared per tenant (all tokens combined)
- [ ] Or if per-token, this is clearly documented
- [ ] Dashboard shows combined usage

---

## Notes

- Record any bugs or issues found during testing
- Use API testing tools (Postman, curl, custom scripts) for automation
- Document actual rate limits observed vs documented limits
- Test during different times to verify consistent enforcement
