# UAT: Feature 12.1 - Stripe Setup & Customer Management

## Test Environment Setup

**Prerequisites:**
- Stripe test mode configured
- Test API keys in environment
- Admin/tenant user accounts
- Access to Stripe Dashboard (test mode)

**Test URLs:**
- Subscription Page: `/subscription`
- Stripe Dashboard: https://dashboard.stripe.com/test

---

## Test Cases

### TC-12.1.1: Stripe Configuration Verified

**Steps:**
1. Check environment variables are set
2. Verify Stripe keys in config

**Expected Results:**
- [ ] STRIPE_KEY environment variable set
- [ ] STRIPE_SECRET environment variable set
- [ ] STRIPE_WEBHOOK_SECRET set
- [ ] No production keys in test environment

---

### TC-12.1.2: Tenant Has Billable Trait

**Steps:**
1. Register a new tenant
2. Check Tenant model includes Billable trait

**Expected Results:**
- [ ] Tenant model uses Billable trait
- [ ] Cashier methods available on Tenant
- [ ] No errors when accessing billing methods

---

### TC-12.1.3: Stripe Customer Created on Registration

**Steps:**
1. Register a new tenant through the app
2. Check Stripe Dashboard for new customer
3. Check tenant record in database

**Expected Results:**
- [ ] Customer created in Stripe automatically
- [ ] stripe_id stored on tenant record
- [ ] Customer name matches tenant name
- [ ] Customer email matches owner email

---

### TC-12.1.4: Existing Tenant Linked to Stripe

**Steps:**
1. Log in as existing tenant without stripe_id
2. Navigate to subscription page
3. Verify Stripe customer is created on demand

**Expected Results:**
- [ ] Stripe customer created when needed
- [ ] No duplicate customers created
- [ ] stripe_id updated on tenant

---

### TC-12.1.5: Plan Configuration Accessible

**Steps:**
1. Check config/stripe.php exists
2. Verify plan price IDs are configured

**Expected Results:**
- [ ] Config file exists
- [ ] Starter plan monthly/yearly prices defined
- [ ] Professional plan prices defined
- [ ] Enterprise plan prices defined
- [ ] Add-on prices defined

---

### TC-12.1.6: Subscription Page Loads

**Steps:**
1. Log in as admin
2. Navigate to `/subscription`

**Expected Results:**
- [ ] Page loads without errors
- [ ] Current plan displayed (or no subscription message)
- [ ] Upgrade options visible
- [ ] No Stripe errors in logs

---

### TC-12.1.7: Retrieve Stripe Customer Data

**Steps:**
1. Log in as tenant with Stripe customer
2. Access billing/subscription section
3. Verify customer data retrieval

**Expected Results:**
- [ ] Customer data loads from Stripe
- [ ] No API errors
- [ ] Customer email matches
- [ ] Customer name matches

---

### TC-12.1.8: Cashier Migrations Run

**Steps:**
1. Check database schema
2. Verify Cashier tables exist

**Expected Results:**
- [ ] customers table exists
- [ ] subscriptions table exists
- [ ] subscription_items table exists
- [ ] Tables have correct columns

---

### TC-12.1.9: Stripe Service Instantiates

**Steps:**
1. Check StripeService class exists
2. Verify it can be instantiated

**Expected Results:**
- [ ] StripeService class created
- [ ] Dependency injection works
- [ ] Stripe client configured
- [ ] No initialization errors

---

## Notes

- All testing should be done in Stripe TEST mode
- Use Stripe test card numbers (4242 4242 4242 4242)
- Monitor Stripe Dashboard for webhook activity
- Check Laravel logs for any Stripe API errors
- Verify no sensitive keys exposed in frontend
