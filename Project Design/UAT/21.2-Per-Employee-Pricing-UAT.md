# UAT: Feature 21.2 - Per-Employee Pricing

## Test Environment Setup

**Prerequisites:**
- Tenant on a plan with per-employee pricing component
- Admin user with billing access
- Multiple employees (some active, some inactive)
- Published schedules with varying employee assignments
- Test Stripe account for billing verification

**Test URL:** `/settings/billing`, `/settings/usage`

---

## Test Cases

### TC-21.2.1: View Usage Dashboard

**Steps:**
1. Log in as an admin
2. Navigate to Settings > Billing > Usage

**Expected Results:**
- [ ] Usage dashboard loads successfully
- [ ] Shows current active employee count
- [ ] Shows billing period dates
- [ ] Shows estimated charges for period

---

### TC-21.2.2: Active Employee Definition - Scheduled

**Steps:**
1. Create a schedule with Employee A assigned to shifts
2. Employee B has no shifts this period
3. Check usage count

**Expected Results:**
- [ ] Employee A counts as active
- [ ] Employee B does NOT count as active
- [ ] Count accurately reflects only scheduled employees

---

### TC-21.2.3: Active Employee Definition - Clocked In

**Steps:**
1. Employee C has no scheduled shifts but clocks in
2. Check usage count

**Expected Results:**
- [ ] Employee C counts as active for the period
- [ ] Clock-in activity triggers active status
- [ ] Usage count increases

---

### TC-21.2.4: Monthly Usage Calculation

**Steps:**
1. View usage at start of billing period
2. Schedule employees throughout the month
3. View usage at end of billing period

**Expected Results:**
- [ ] Running count updates as employees become active
- [ ] Final count matches all active employees
- [ ] Calculation matches "scheduled OR clocked in" criteria

---

### TC-21.2.5: Stripe Metered Billing Integration

**Steps:**
1. Complete a billing period with metered usage
2. Check Stripe dashboard for metered billing records
3. Verify invoice generation

**Expected Results:**
- [ ] Usage reported to Stripe correctly
- [ ] Metered billing line item on invoice
- [ ] Amount matches usage * per-employee rate
- [ ] Invoice generated at period end

---

### TC-21.2.6: Usage Shown in Billing Dashboard

**Steps:**
1. Navigate to Settings > Billing
2. View current billing details

**Expected Results:**
- [ ] Per-employee usage clearly shown
- [ ] Base subscription cost shown
- [ ] Metered charges shown separately
- [ ] Total estimated bill displayed

---

### TC-21.2.7: Usage Reports Sent to Tenants

**Steps:**
1. Complete a billing period
2. Check admin email for usage report

**Expected Results:**
- [ ] Usage report email received
- [ ] Details active employee count
- [ ] Shows breakdown by period
- [ ] Matches dashboard figures

---

### TC-21.2.8: Real-Time Usage Updates

**Steps:**
1. View usage dashboard
2. In another tab, schedule a new employee for a shift
3. Refresh usage dashboard

**Expected Results:**
- [ ] Usage count reflects new active employee
- [ ] Update is near real-time or within reasonable delay
- [ ] No manual refresh of billing required

---

### TC-21.2.9: Inactive Employee Not Counted

**Steps:**
1. Deactivate an employee account
2. Verify they had no shifts or clock-ins this period
3. Check usage count

**Expected Results:**
- [ ] Deactivated employee not counted
- [ ] Only active employee accounts with activity counted
- [ ] Clear distinction in reporting

---

### TC-21.2.10: Mid-Period Employee Addition

**Steps:**
1. Start a new billing period
2. Halfway through, add a new employee and schedule them
3. Check usage calculation

**Expected Results:**
- [ ] New employee counted from when they became active
- [ ] Pro-rating handled correctly (if applicable)
- [ ] Usage dashboard reflects addition

---

### TC-21.2.11: Historical Usage View

**Steps:**
1. Navigate to billing/usage history
2. View previous billing periods

**Expected Results:**
- [ ] Past periods show historical usage
- [ ] Can see employee count per period
- [ ] Matches invoiced amounts
- [ ] Clear timeline of usage

---

### TC-21.2.12: Usage Forecast/Estimate

**Steps:**
1. View current period usage dashboard
2. Look for projected/estimated final usage

**Expected Results:**
- [ ] Shows current active count
- [ ] May show projected end-of-period estimate
- [ ] Helps admin anticipate billing
- [ ] Based on current trajectory

---

### TC-21.2.13: Multiple Locations Usage

**Steps:**
1. Tenant with multiple locations
2. Schedule employees across locations
3. Check usage count

**Expected Results:**
- [ ] Each unique employee counted once
- [ ] Not double-counted if at multiple locations
- [ ] Total is per-employee, not per-location-employee

---

### TC-21.2.14: Invoice Accuracy

**Steps:**
1. Complete a full billing cycle
2. Receive invoice from Stripe
3. Compare to usage dashboard

**Expected Results:**
- [ ] Invoice matches dashboard figures
- [ ] Per-employee line item accurate
- [ ] No unexpected charges
- [ ] Clear breakdown of costs

---

## Notes

- Record any bugs or issues found during testing
- Test with Stripe test mode
- Verify webhook handling for usage reporting
- Document any edge cases with employee status changes
