# UAT: Feature 3.7 - Attendance Reports

## Test Environment Setup

**Prerequisites:**
- One admin user
- Multiple employees with varied attendance history
- Time entries spanning several weeks
- Mix of on-time, late, early, overtime, and missed shifts
- Multiple departments and locations for filtering

**Test URL:** `/reports/attendance`

---

## Test Cases

### TC-3.7.1: Access Attendance Reports Dashboard

**Steps:**
1. Log in as an admin
2. Navigate to `/reports/attendance`

**Expected Results:**
- [x] Reports dashboard loads
- [x] Summary cards show Attendance Rate, Punctuality Rate, Overtime Hours, Missed Shifts
- [x] Hours Summary section shows Scheduled Hours, Actual Hours, Variance, Average Variance
- [x] Links to detailed reports available (Punctuality, Hours Worked, Overtime, Absence)
- [x] Date range filter visible (defaults to current month)
- [x] Department and Location filter dropdowns available

---

### TC-3.7.2: Employee Cannot Access Reports

**Steps:**
1. Log in as an employee
2. Try to navigate to `/reports/attendance`

**Expected Results:**
- [x] Access denied (403 Forbidden)
- [x] Try `/reports/attendance/punctuality` - returns 403
- [x] Try `/reports/attendance/export/punctuality` - returns 403

---

### TC-3.7.3: Date Range Filtering

**Steps:**
1. View attendance reports dashboard
2. Change start date to previous month
3. Change end date
4. Click "Apply Filters"
5. Click "Clear"

**Expected Results:**
- [x] Default shows current month
- [x] Date inputs accept new values
- [x] Report data refreshes with new date range
- [x] URL updates with query parameters
- [x] Clear link resets to default date range

---

### TC-3.7.4: Department Filtering

**Steps:**
1. View attendance reports
2. Select a department from dropdown
3. Click "Apply Filters"

**Expected Results:**
- [x] Only data for selected department shows
- [x] All metrics reflect department only
- [x] Filter persists when navigating to sub-reports

---

### TC-3.7.5: Location Filtering

**Steps:**
1. View attendance reports
2. Select a location from dropdown
3. Click "Apply Filters"

**Expected Results:**
- [x] Only data for selected location shows
- [x] All metrics reflect location only
- [x] Can combine with department and date filters

---

### TC-3.7.6: Punctuality Report

**Steps:**
1. Click "Punctuality Report" from dashboard
2. View summary cards
3. View employee table
4. Click "View" on an employee

**Expected Results:**
- [x] Summary shows Punctuality Rate, On Time, Late, Early counts
- [x] Table lists employees with On Time, Late, Early, Total, Rate, Avg Late Minutes
- [x] Color-coded punctuality rate badges (green >= 90%, yellow >= 75%, red < 75%)
- [x] "View" link navigates to employee detail report
- [x] Breadcrumb shows "Attendance Reports > Punctuality"

---

### TC-3.7.7: Hours Worked Report

**Steps:**
1. Click "Hours Worked Report" from dashboard
2. View summary cards
3. View employee table

**Expected Results:**
- [x] Summary shows Total Scheduled, Total Worked, Variance
- [x] Table lists Scheduled Hours, Actual Hours, Variance, Entries per employee
- [x] Variance badges: orange for positive (overtime), red for negative, green for near zero
- [x] Sorted by actual hours worked (highest first)

---

### TC-3.7.8: Overtime Report

**Steps:**
1. Click "Overtime Report" from dashboard
2. View summary and employee table

**Expected Results:**
- [x] Summary shows Total Overtime Hours, Overtime Entries
- [x] Only employees with overtime entries are listed
- [x] Shows Overtime Hours and Entries per employee
- [x] Empty state shown if no overtime entries exist

---

### TC-3.7.9: Absence Report

**Steps:**
1. Click "Absence Report" from dashboard
2. View summary and tables

**Expected Results:**
- [x] Summary shows Total Missed Shifts
- [x] By Employee table shows missed count per person
- [x] Missed Shift Details table shows Date, Shift Time, Role, Department
- [x] Empty state shown if no missed shifts

---

### TC-3.7.10: Employee Detail Report

**Steps:**
1. From any report, click "View" on an employee
2. Review the employee's detailed report

**Expected Results:**
- [x] Shows employee name in header and breadcrumb
- [x] Summary cards: Attendance Rate, Punctuality Rate, Overtime, Missed Shifts
- [x] Hours Summary: Scheduled, Worked, Undertime, Average Variance
- [x] Missed Shifts table (if any) with Date, Shift Time, Role, Location
- [x] "Back to Reports" button works

---

### TC-3.7.11: Department Detail Report

**Steps:**
1. Navigate to `/reports/attendance/department/{id}`
2. Review the department report

**Expected Results:**
- [x] Shows department name in header and breadcrumb
- [x] Aggregated metrics for all employees in department
- [x] Hours Summary for department totals

---

### TC-3.7.12: Export Punctuality to CSV

**Steps:**
1. View punctuality report
2. Click "Export CSV"
3. Open downloaded file

**Expected Results:**
- [x] CSV file downloads with appropriate filename
- [x] Contains header: Employee, On Time, Late, Early, Total, Punctuality Rate, Avg Late Minutes
- [x] Data matches on-screen report
- [x] Current filters applied to export

---

### TC-3.7.13: Export Hours to CSV

**Steps:**
1. View hours worked report
2. Click "Export CSV"
3. Open downloaded file

**Expected Results:**
- [x] Header: Employee, Scheduled Hours, Actual Hours, Variance Hours, Entries
- [x] Data matches displayed report

---

### TC-3.7.14: Export Overtime to CSV

**Steps:**
1. View overtime report
2. Click "Export CSV"

**Expected Results:**
- [x] Header: Employee, Overtime Hours, Overtime Entries
- [x] Only employees with overtime included

---

### TC-3.7.15: Export Absence to CSV

**Steps:**
1. View absence report
2. Click "Export CSV"

**Expected Results:**
- [x] Header: Employee, Missed Shifts
- [x] Counts match displayed totals

---

### TC-3.7.16: Metrics Calculation Accuracy

**Steps:**
1. Create known test data:
   - 10 scheduled shifts, 8 worked
   - 10 arrivals: 6 on-time, 3 late, 1 early
   - 1 entry with 60 minutes overtime
   - 2 missed shifts
2. Verify calculations

**Expected Results:**
- [x] Attendance rate: 80% (8/10)
- [x] Punctuality rate: 60% (6/10)
- [x] Overtime: 1.0h
- [x] Missed shifts: 2

---

### TC-3.7.17: Cross-Tenant Isolation

**Steps:**
1. Create employee in different tenant
2. Try to access their report via `/reports/attendance/employee/{id}`

**Expected Results:**
- [x] Returns 403 Forbidden
- [x] Cannot access cross-tenant data
- [x] Department cross-tenant also blocked

---

### TC-3.7.18: Empty State Display

**Steps:**
1. View reports with no time entries in date range
2. Check each report type

**Expected Results:**
- [x] Dashboard shows 0 values gracefully
- [x] Punctuality report shows "No clock-in data found"
- [x] Overtime report shows "No overtime entries found"
- [x] Absence report shows "No missed shifts found"

---

### TC-3.7.19: Filter Persistence

**Steps:**
1. Apply date range and department filter on dashboard
2. Click "Punctuality Report"
3. Click "Export CSV"

**Expected Results:**
- [x] Filters are passed in URL to sub-reports
- [x] Export uses same filters
- [x] Back to Reports preserves filters

---

### TC-3.7.20: Responsive Design

**Steps:**
1. View reports on desktop
2. Resize browser to mobile width
3. Check all report views

**Expected Results:**
- [x] Cards stack vertically on mobile
- [x] Tables scroll horizontally
- [x] Filters remain accessible
- [x] Export buttons visible

---

## Notes

- Record any bugs or issues found during testing
- Note the browser and device used for testing
- Screenshot any unexpected behavior
- PDF export not implemented in this phase (CSV only)
- Charts/visualizations to be added in Phase 5 (Reports & Analytics)
