# UAT: Feature 1.4 - Leave Allowances Management

## Test Environment Setup

**Prerequisites:**
- One admin user
- Multiple employee users
- At least one active leave type that affects allowance
- One employee user for testing

**Test URL:** `/leave-allowances`

---

## Test Cases

### TC-1.4.1: View Leave Allowances Index (Admin)

**Steps:**
1. Log in as an admin
2. Navigate to "Leave Allowances" in the sidebar

**Expected Results:**
- [ ] Page loads successfully
- [ ] Shows filter options for Year and Leave Type
- [ ] Default year is current year
- [ ] Shows allowances table with columns: Employee, Leave Type, Total, Used, Carried Over, Remaining
- [ ] "Add allowance" button is visible

---

### TC-1.4.2: Employee Cannot Access Leave Allowances

**Steps:**
1. Log in as an employee
2. Try to navigate to `/leave-allowances` directly

**Expected Results:**
- [ ] Access is denied (403 error)
- [ ] "Leave Allowances" link is not visible in sidebar

---

### TC-1.4.3: Filter by Year

**Steps:**
1. Log in as an admin
2. Navigate to Leave Allowances
3. Change the Year dropdown to a different year
4. Click "Filter"

**Expected Results:**
- [ ] Table refreshes with allowances for selected year
- [ ] Year filter persists in URL
- [ ] Correct data is displayed

---

### TC-1.4.4: Filter by Leave Type

**Steps:**
1. Log in as an admin
2. Navigate to Leave Allowances
3. Select a specific Leave Type from dropdown
4. Click "Filter"

**Expected Results:**
- [ ] Table shows only allowances for that leave type
- [ ] Filter can be cleared
- [ ] Combined with year filter works correctly

---

### TC-1.4.5: Create Leave Allowance

**Steps:**
1. Log in as an admin
2. Navigate to Leave Allowances
3. Click "Add allowance"
4. Select an Employee
5. Select a Leave Type
6. Select Year (current year)
7. Enter Total Days: 25
8. Enter Carried Over Days: 5
9. Click "Create Allowance"

**Expected Results:**
- [ ] Form submits successfully
- [ ] Redirected to index with success message
- [ ] New allowance appears in the list
- [ ] Shows Total: 25, Used: 0, Carried Over: 5, Remaining: 30

---

### TC-1.4.6: Cannot Create Duplicate Allowance

**Steps:**
1. Log in as an admin
2. Create an allowance for Employee A, Leave Type X, Year 2024
3. Try to create another allowance for the same combination

**Expected Results:**
- [ ] Error message displayed
- [ ] Second allowance is not created
- [ ] Message explains the duplicate

---

### TC-1.4.7: Edit Leave Allowance

**Steps:**
1. Log in as an admin
2. Navigate to Leave Allowances
3. Click "Edit" on an existing allowance
4. Change Total Days from 25 to 30
5. Change Carried Over Days from 0 to 3
6. Click "Save Changes"

**Expected Results:**
- [ ] Edit form shows current values
- [ ] Employee, Leave Type, and Year are shown but not editable
- [ ] Shows current Used Days (read-only)
- [ ] Changes are saved
- [ ] Remaining days recalculated correctly

---

### TC-1.4.8: Delete Unused Allowance

**Steps:**
1. Log in as an admin
2. Find an allowance with Used Days = 0
3. Click "Delete"
4. Confirm deletion

**Expected Results:**
- [ ] Allowance is deleted
- [ ] Success message shown
- [ ] No longer appears in list

---

### TC-1.4.9: Cannot Delete Used Allowance

**Steps:**
1. Log in as an admin
2. Find an allowance with Used Days > 0
3. Try to delete it

**Expected Results:**
- [ ] Delete button/link is not visible OR
- [ ] Error message when attempting to delete
- [ ] Allowance is NOT deleted

---

### TC-1.4.10: Remaining Days Color Coding

**Steps:**
1. Log in as an admin
2. View allowances with different remaining days:
   - One with 0 remaining
   - One with 1-5 remaining
   - One with 10+ remaining

**Expected Results:**
- [ ] 0 or negative remaining: Red color
- [ ] Low remaining (1-5): Amber/yellow color
- [ ] Healthy remaining (6+): Green color

---

### TC-1.4.11: Validation - Required Fields

**Steps:**
1. Log in as an admin
2. Go to create allowance form
3. Try to submit without selecting Employee
4. Try to submit without selecting Leave Type
5. Try to submit without Total Days

**Expected Results:**
- [ ] Each required field shows validation error
- [ ] Form does not submit until all required fields filled

---

### TC-1.4.12: Tenant Isolation

**Steps:**
1. Create an allowance as Admin of Tenant A
2. Log in as Admin of Tenant B
3. Try to access the allowance from Tenant A

**Expected Results:**
- [ ] Admin B cannot see Tenant A's allowances
- [ ] Direct URL access returns 404 (due to tenant scoping)
- [ ] Each tenant has separate allowance records

---

### TC-1.4.13: Only Shows Leave Types That Affect Allowance

**Steps:**
1. Create a leave type with "Affects Allowance" = No
2. Go to create allowance form
3. Check the Leave Type dropdown

**Expected Results:**
- [ ] Leave types with "Affects Allowance" = No do NOT appear
- [ ] Only leave types that affect allowance are selectable

---

## Notes

- Record any bugs or issues found during testing
- Note the browser and device used for testing
- Screenshot any unexpected behavior
