# UAT: Feature 1.6 - Subscription & Feature Management

## Test Environment Setup

**Prerequisites:**
- One admin user
- One employee user
- Access to the subscription page
- Different tenants for isolation testing

**Test URLs:**
- Subscription: `/subscription`
- Upgrade: `/subscription/upgrade`
- Feature API: `/api/features`

---

## Test Cases

### TC-1.6.1: View Subscription Page (Admin)

**Steps:**
1. Log in as an admin
2. Navigate to "Subscription" in the sidebar

**Expected Results:**
- [ ] Page loads successfully
- [ ] Shows current plan with status badge
- [ ] Shows billing cycle (Monthly/Annual)
- [ ] Shows current period end date
- [ ] Lists all features with enabled/disabled status
- [ ] Shows "Upgrade Plan" button

---

### TC-1.6.2: Employee Cannot Access Subscription Page

**Steps:**
1. Log in as an employee
2. Try to navigate to `/subscription` directly

**Expected Results:**
- [ ] Access is denied (403 error)
- [ ] "Subscription" link is not visible in sidebar

---

### TC-1.6.3: View Upgrade Page (Admin)

**Steps:**
1. Log in as an admin
2. Navigate to Subscription page
3. Click "Upgrade Plan"

**Expected Results:**
- [ ] Page loads successfully
- [ ] Shows all three plans (Basic, Professional, Enterprise)
- [ ] Current plan is highlighted with "Current Plan" badge
- [ ] Each plan shows monthly and annual pricing
- [ ] Features are listed with checkmarks/X marks
- [ ] Add-ons section shows individual feature prices

---

### TC-1.6.4: Employee Cannot Access Upgrade Page

**Steps:**
1. Log in as an employee
2. Try to navigate to `/subscription/upgrade` directly

**Expected Results:**
- [ ] Access is denied (403 error)

---

### TC-1.6.5: Verify Default Subscription for New Tenant

**Steps:**
1. Register a new organization
2. Log in as that organization's admin
3. Navigate to Subscription page

**Expected Results:**
- [ ] Subscription exists automatically
- [ ] Plan is "Basic"
- [ ] Status is "Trialing"
- [ ] Billing cycle is "Monthly"
- [ ] Period end is ~14 days from creation

---

### TC-1.6.6: Basic Plan Feature Access

**Steps:**
1. Log in as admin of a Basic plan tenant
2. Check each feature's status on subscription page

**Expected Results:**
- [ ] AI Scheduling: Not included
- [ ] Advanced Analytics: Not included
- [ ] API Access: Not included
- [ ] Priority Support: Not included
- [ ] All show as "X" or disabled

---

### TC-1.6.7: Professional Plan Feature Access

**Steps:**
1. Manually update a tenant's subscription to Professional (via database)
2. Log in as admin
3. Check subscription page

**Expected Results:**
- [ ] AI Scheduling: Included (checkmark, "Included in plan")
- [ ] Advanced Analytics: Included (checkmark, "Included in plan")
- [ ] API Access: Not included
- [ ] Priority Support: Not included

---

### TC-1.6.8: Enterprise Plan Feature Access

**Steps:**
1. Manually update a tenant's subscription to Enterprise (via database)
2. Log in as admin
3. Check subscription page

**Expected Results:**
- [ ] AI Scheduling: Included
- [ ] Advanced Analytics: Included
- [ ] API Access: Included
- [ ] Priority Support: Included
- [ ] All show as "Included in plan"

---

### TC-1.6.9: Feature API - Status Endpoint

**Steps:**
1. Log in as admin
2. Navigate to `/api/features` in browser or use fetch

**Expected Results:**
- [ ] Returns JSON response
- [ ] Contains `plan` field with current plan
- [ ] Contains `status` field with subscription status
- [ ] Contains `features` object with all four features
- [ ] Each feature has `enabled` (boolean) and `source` (plan/addon/null)

---

### TC-1.6.10: Feature API - Check Individual Feature

**Steps:**
1. Log in as admin
2. Navigate to `/api/features/ai_scheduling`

**Expected Results:**
- [ ] Returns JSON response
- [ ] Contains `feature` field
- [ ] Contains `enabled` boolean
- [ ] Contains `label` (human-readable name)

---

### TC-1.6.11: Feature API - Unknown Feature

**Steps:**
1. Log in as admin
2. Navigate to `/api/features/unknown_feature`

**Expected Results:**
- [ ] Returns 400 status code
- [ ] Error message indicates unknown feature

---

### TC-1.6.12: Feature Add-on Access

**Steps:**
1. Create a Basic plan tenant
2. Manually add an API Access add-on (via database)
3. Log in as admin
4. Check subscription page

**Expected Results:**
- [ ] API Access shows as enabled
- [ ] Source shows as "Add-on"
- [ ] Active Add-ons section lists it with enabled date
- [ ] Monthly price is displayed

---

### TC-1.6.13: Expired Add-on

**Steps:**
1. Create a Basic plan tenant
2. Add an API Access add-on with past expires_at date
3. Log in as admin
4. Check subscription page

**Expected Results:**
- [ ] API Access shows as disabled/not included
- [ ] Expired add-on should not grant access
- [ ] Feature API returns enabled: false

---

### TC-1.6.14: Subscription Status - Active

**Steps:**
1. Set a tenant's subscription status to "Active"
2. Log in as admin
3. Check subscription page

**Expected Results:**
- [ ] Status badge shows "Active" with green color
- [ ] Plan features are accessible

---

### TC-1.6.15: Subscription Status - Trialing

**Steps:**
1. Set a tenant's subscription status to "Trialing"
2. Log in as admin
3. Check subscription page

**Expected Results:**
- [ ] Status badge shows "Trialing" with blue color
- [ ] Shows "Trial ends [date]" message
- [ ] Plan features are still accessible

---

### TC-1.6.16: Subscription Status - Past Due

**Steps:**
1. Set a tenant's subscription status to "Past Due"
2. Log in as admin
3. Check subscription page

**Expected Results:**
- [ ] Status badge shows "Past Due" with yellow color
- [ ] Plan features are still accessible (grace period)

---

### TC-1.6.17: Subscription Status - Cancelled

**Steps:**
1. Set a tenant's subscription status to "Cancelled"
2. Log in as admin
3. Check subscription page

**Expected Results:**
- [ ] Status badge shows "Cancelled" with red color
- [ ] Plan features are NOT accessible
- [ ] Feature API returns enabled: false for all features

---

### TC-1.6.18: Tenant Isolation - Different Plans

**Steps:**
1. Set Tenant A to Enterprise plan
2. Set Tenant B to Basic plan
3. Log in as Tenant A admin, check subscription
4. Log in as Tenant B admin, check subscription

**Expected Results:**
- [ ] Tenant A shows Enterprise with all features
- [ ] Tenant B shows Basic with no features
- [ ] Changes to one do not affect the other

---

### TC-1.6.19: Tenant Isolation - Add-ons

**Steps:**
1. Add API Access add-on to Tenant A
2. Log in as Tenant B admin

**Expected Results:**
- [ ] Tenant B does NOT have API Access
- [ ] Add-ons are tenant-specific

---

### TC-1.6.20: Blade Directive (@feature)

**Steps:**
1. Add test content in a blade file:
   ```blade
   @feature('ai_scheduling')
       <p>AI Feature Content</p>
   @endfeature
   ```
2. View as Professional/Enterprise tenant
3. View as Basic tenant

**Expected Results:**
- [ ] Professional/Enterprise sees content
- [ ] Basic tenant does not see content

---

### TC-1.6.21: Feature Gate Component

**Steps:**
1. Add test content in a blade file:
   ```blade
   <x-feature-gate feature="advanced_analytics">
       <p>Analytics Content</p>
   </x-feature-gate>
   ```
2. View as Professional/Enterprise tenant
3. View as Basic tenant

**Expected Results:**
- [ ] Professional/Enterprise sees content
- [ ] Basic tenant does not see content

---

### TC-1.6.22: Sidebar Link Visibility

**Steps:**
1. Log in as admin
2. Check sidebar for "Subscription" link
3. Log in as employee
4. Check sidebar

**Expected Results:**
- [ ] Admin sees Subscription link
- [ ] Employee does NOT see Subscription link
- [ ] Link highlights when on subscription pages

---

### TC-1.6.23: Plan Comparison on Upgrade Page

**Steps:**
1. Log in as admin of a Professional plan tenant
2. Navigate to upgrade page

**Expected Results:**
- [ ] Professional plan shows "Current Plan" badge
- [ ] Enterprise shows "Upgrade to Enterprise" button
- [ ] Basic shows "Downgrade to Basic" button
- [ ] Current plan button is disabled

---

### TC-1.6.24: Add-on Prices Display

**Steps:**
1. Navigate to upgrade page as admin
2. Check add-ons section

**Expected Results:**
- [ ] Each add-on shows monthly price
- [ ] Features already in plan show "Included"
- [ ] Purchased add-ons show "Active"
- [ ] Others show "Add" button

---

## Notes

- Payment integration is not yet implemented (Phase 12)
- Upgrade/downgrade buttons are visual only for now
- Test with database modifications for plan/status changes
- Record any bugs or issues found during testing
- Note the browser and device used for testing
- Screenshot any unexpected behavior
