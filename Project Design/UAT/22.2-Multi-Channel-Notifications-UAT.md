# UAT: Feature 22.2 - Multi-Channel Notifications

## Test Environment Setup

**Prerequisites:**
- Admin user with integration permissions
- Slack workspace for testing
- Microsoft Teams tenant for testing
- WhatsApp Business API access (if available)
- Employee accounts for preference testing

**Test URL:** `/settings/notification-channels`, `/settings/integrations`

---

## Test Cases

### TC-22.2.1: View Notification Channel Settings

**Steps:**
1. Log in as an admin
2. Navigate to Settings > Notification Channels

**Expected Results:**
- [ ] Notification channels page loads
- [ ] Available channels listed (Email, Slack, Teams, WhatsApp)
- [ ] Current integration status shown
- [ ] Configure button for each channel

---

### TC-22.2.2: Slack OAuth Integration Setup

**Steps:**
1. Navigate to Notification Channels
2. Click "Connect Slack"
3. Complete Slack OAuth flow
4. Authorize the app in Slack workspace

**Expected Results:**
- [ ] OAuth redirect works correctly
- [ ] Slack authorization page shown
- [ ] App authorized successfully
- [ ] Returns to Plannrly with success message
- [ ] Slack shows as connected

---

### TC-22.2.3: Microsoft Teams Integration Setup

**Steps:**
1. Navigate to Notification Channels
2. Click "Connect Microsoft Teams"
3. Complete Microsoft OAuth flow
4. Authorize the app in Teams

**Expected Results:**
- [ ] OAuth redirect to Microsoft
- [ ] Proper scopes requested
- [ ] Authorization completes
- [ ] Teams shows as connected
- [ ] Bot installed in Teams (if applicable)

---

### TC-22.2.4: WhatsApp Business API Setup

**Steps:**
1. Navigate to Notification Channels
2. Click "Connect WhatsApp"
3. Enter WhatsApp Business API credentials
4. Verify connection

**Expected Results:**
- [ ] API credentials form shown
- [ ] Connection test available
- [ ] Verification successful
- [ ] WhatsApp shows as connected

---

### TC-22.2.5: User Notification Preferences

**Steps:**
1. Log in as an employee
2. Navigate to Profile > Notification Preferences
3. Enable/disable channels for different notification types

**Expected Results:**
- [ ] All connected channels shown
- [ ] Can select channel per notification type
- [ ] Multiple channels can be selected
- [ ] Preferences saved successfully

---

### TC-22.2.6: Slack Notification Delivery

**Steps:**
1. User enables Slack notifications
2. Link Slack account to Plannrly profile
3. Trigger a notification (e.g., shift assigned)
4. Check Slack

**Expected Results:**
- [ ] Notification received in Slack
- [ ] Message formatted nicely
- [ ] Contains relevant information
- [ ] Link back to Plannrly (if applicable)

---

### TC-22.2.7: Teams Notification Delivery

**Steps:**
1. User enables Teams notifications
2. Link Teams account to Plannrly profile
3. Trigger a notification
4. Check Teams

**Expected Results:**
- [ ] Notification received in Teams
- [ ] Adaptive card format (if supported)
- [ ] Contains relevant information
- [ ] Actionable elements work

---

### TC-22.2.8: WhatsApp Notification Delivery

**Steps:**
1. User enables WhatsApp notifications
2. Verify phone number for WhatsApp
3. Trigger a notification
4. Check WhatsApp

**Expected Results:**
- [ ] Notification received on WhatsApp
- [ ] Message formatted appropriately
- [ ] Business account identified
- [ ] Delivered promptly

---

### TC-22.2.9: Channel-Specific Message Formatting

**Steps:**
1. Trigger the same notification to multiple channels
2. Compare formatting across channels

**Expected Results:**
- [ ] Email has full HTML formatting
- [ ] Slack uses Slack blocks/markdown
- [ ] Teams uses adaptive cards
- [ ] WhatsApp uses plain text appropriately
- [ ] All convey same information

---

### TC-22.2.10: Notification Type Channel Selection

**Steps:**
1. Configure preferences:
   - Shift changes: Slack + Email
   - Leave approvals: Email only
   - Urgent alerts: All channels
2. Trigger each notification type

**Expected Results:**
- [ ] Shift change goes to Slack and Email
- [ ] Leave approval goes to Email only
- [ ] Urgent alert goes to all channels
- [ ] Preferences respected correctly

---

### TC-22.2.11: Workspace Integration Admin Settings

**Steps:**
1. Log in as admin
2. Navigate to Settings > Integrations
3. Configure workspace-wide Slack settings

**Expected Results:**
- [ ] Can set default Slack channel for announcements
- [ ] Can configure bot permissions
- [ ] Team-wide integration settings available
- [ ] Per-user override possible

---

### TC-22.2.12: Disconnect Integration

**Steps:**
1. Navigate to Notification Channels
2. Click "Disconnect" on Slack integration
3. Confirm disconnection

**Expected Results:**
- [ ] Confirmation prompt shown
- [ ] Integration disconnected
- [ ] Users notified of change
- [ ] Fallback to email notifications

---

### TC-22.2.13: Failed Notification Handling

**Steps:**
1. Configure a notification channel
2. Simulate a delivery failure (invalid token, etc.)
3. Check notification logs

**Expected Results:**
- [ ] Failure logged
- [ ] Retry attempted (if configured)
- [ ] Fallback to email
- [ ] Admin notified of integration issues

---

### TC-22.2.14: User Slack Account Linking

**Steps:**
1. Log in as employee
2. Go to Profile > Connect Slack
3. Authenticate with Slack
4. Link accounts

**Expected Results:**
- [ ] Slack OAuth for user account
- [ ] Accounts linked successfully
- [ ] Slack DMs can now be received
- [ ] Can unlink if needed

---

### TC-22.2.15: Notification Channel Test

**Steps:**
1. Navigate to Notification Channels
2. Click "Send Test Notification" for Slack
3. Check if test message received

**Expected Results:**
- [ ] Test message sent successfully
- [ ] Received in configured channel/DM
- [ ] Confirms integration working
- [ ] Shows result in UI

---

## Notes

- Record any bugs or issues found during testing
- Test with actual Slack/Teams workspaces
- Note any API rate limits encountered
- Document message formatting for each channel
