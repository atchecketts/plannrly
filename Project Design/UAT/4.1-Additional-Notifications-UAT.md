# UAT: Feature 4.1 - Additional Notifications

## Test Environment Setup

**Prerequisites:**
- Admin user account
- Multiple employee user accounts
- Published shifts (some assigned, some not)
- Pending leave requests
- Active swap requests in various states
- Email testing capability (Mailtrap or similar)

**Test URLs:**
- Dashboard: `/dashboard`
- Leave Requests: `/leave-requests`
- Shift Swaps: `/shift-swaps`

---

## Test Cases

### TC-4.1.1: Shift Changed Notification - Employee Notified

**Steps:**
1. Log in as admin
2. Find an assigned shift for an employee
3. Edit the shift (change start time by 1 hour)
4. Save the change
5. Check employee's email and notification inbox

**Expected Results:**
- [ ] Employee receives email notification
- [ ] Email contains shift details (date, old time, new time)
- [ ] In-app notification appears (if enabled)
- [ ] Notification links to shift details
- [ ] Notification clearly states what changed

---

### TC-4.1.2: Shift Deleted Notification

**Steps:**
1. Log in as admin
2. Find an assigned shift for an employee
3. Delete the shift
4. Confirm deletion
5. Check employee's notifications

**Expected Results:**
- [ ] Employee receives email notification
- [ ] Email states shift was cancelled
- [ ] Email includes original shift date/time
- [ ] In-app notification appears
- [ ] Notification is clear about cancellation

---

### TC-4.1.3: Leave Request Approved Notification

**Steps:**
1. Create a pending leave request as an employee
2. Log in as admin
3. Navigate to leave requests
4. Approve the pending request
5. Check the employee's notifications

**Expected Results:**
- [ ] Employee receives email notification
- [ ] Email confirms leave request approved
- [ ] Email includes leave dates
- [ ] In-app notification appears
- [ ] Notification shows approval status

---

### TC-4.1.4: Leave Request Rejected Notification

**Steps:**
1. Create a pending leave request as an employee
2. Log in as admin
3. Navigate to leave requests
4. Reject the request with a reason
5. Check the employee's notifications

**Expected Results:**
- [ ] Employee receives email notification
- [ ] Email states leave request was rejected
- [ ] Email includes rejection reason
- [ ] In-app notification appears
- [ ] Employee can clearly see why rejected

---

### TC-4.1.5: Swap Request Received Notification

**Steps:**
1. Log in as Employee A
2. Create a swap request targeting Employee B
3. Check Employee B's notifications

**Expected Results:**
- [ ] Employee B receives email notification
- [ ] Email contains swap request details
- [ ] Email shows requester's name
- [ ] Email shows which shifts are involved
- [ ] In-app notification appears for Employee B
- [ ] Notification links to swap request

---

### TC-4.1.6: Swap Request Accepted Notification

**Steps:**
1. Employee A creates swap request for Employee B
2. Log in as Employee B
3. Accept the swap request
4. Check Employee A's notifications

**Expected Results:**
- [ ] Employee A receives email notification
- [ ] Email confirms swap was accepted
- [ ] Email shows both shifts involved
- [ ] In-app notification appears
- [ ] Notification clearly indicates acceptance

---

### TC-4.1.7: Swap Request Rejected Notification

**Steps:**
1. Employee A creates swap request for Employee B
2. Log in as Employee B
3. Reject the swap request
4. Check Employee A's notifications

**Expected Results:**
- [ ] Employee A receives email notification
- [ ] Email states swap was declined
- [ ] In-app notification appears
- [ ] Notification indicates rejection

---

### TC-4.1.8: Shift Reminder Notification - 1 Hour Before

**Steps:**
1. Configure shift reminder to 1 hour before
2. Create a shift for an employee starting in 1 hour
3. Wait for scheduled reminder command to run (or trigger manually)
4. Check employee's notifications

**Expected Results:**
- [ ] Employee receives reminder notification
- [ ] Notification shows shift start time
- [ ] Notification sent at configured time before shift
- [ ] Includes shift location if applicable
- [ ] Does not send duplicate reminders

---

### TC-4.1.9: Shift Reminder - Employee on Leave

**Steps:**
1. Mark an employee on approved leave
2. Have a shift scheduled during leave period
3. Wait for reminder scheduler to run

**Expected Results:**
- [ ] No reminder sent for shift during leave
- [ ] Or clear indication shift is during approved leave
- [ ] System handles edge case gracefully

---

### TC-4.1.10: Multiple Notification Channels

**Steps:**
1. Trigger a notification event (e.g., approve leave request)
2. Check email
3. Check in-app notifications
4. Check database notification record

**Expected Results:**
- [ ] Email sent successfully
- [ ] In-app notification recorded in database
- [ ] Both channels have consistent information
- [ ] Timestamps are accurate
- [ ] User can access via both channels

---

### TC-4.1.11: Notification Not Sent for Unpublished Schedule

**Steps:**
1. Create a shift on an unpublished schedule
2. Change or delete the shift
3. Check if notification was sent

**Expected Results:**
- [ ] No notification sent for unpublished schedule changes
- [ ] System only notifies for published schedule changes
- [ ] Or notification clearly marked as draft/unpublished

---

## Notes

- Test email delivery in staging environment with Mailtrap
- Verify notification timestamps match timezone settings
- Check that notifications don't spam users for bulk operations
- Test notification queue processing if using queued jobs
- Verify HTML email templates render correctly
