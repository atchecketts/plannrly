# UAT: Feature 20.2 - Data Import

## Test Environment Setup

**Prerequisites:**
- Admin user with import permissions
- Sample CSV files with employee data
- Sample Excel files with employee data
- Files with intentional errors for testing validation
- Files with various encodings (UTF-8, Windows-1252)

**Test URL:** `/import`

---

## Test Cases

### TC-20.2.1: View Data Import Index

**Steps:**
1. Log in as an admin
2. Navigate to Settings > Import Data

**Expected Results:**
- [ ] Import page loads successfully
- [ ] File upload area is visible
- [ ] Supported formats are listed (CSV, Excel)
- [ ] Import history shown (if any previous imports)

---

### TC-20.2.2: Upload CSV File

**Steps:**
1. Navigate to Import Data
2. Upload a valid CSV file with employee data
3. Wait for file processing

**Expected Results:**
- [ ] File uploads successfully
- [ ] Progress indicator shown during upload
- [ ] Proceeds to field mapping step
- [ ] First few rows are previewed

---

### TC-20.2.3: Upload Excel File

**Steps:**
1. Navigate to Import Data
2. Upload a valid Excel (.xlsx) file
3. Wait for file processing

**Expected Results:**
- [ ] Excel file uploads successfully
- [ ] Sheet selection shown if multiple sheets
- [ ] Proceeds to field mapping step
- [ ] Data preview is shown

---

### TC-20.2.4: Field Mapping Interface

**Steps:**
1. Upload a data file
2. View the field mapping screen
3. Map source columns to Plannrly fields

**Expected Results:**
- [ ] All source columns are listed
- [ ] Dropdown for each source column to map to destination
- [ ] Auto-mapping suggestions based on column names
- [ ] Required fields are clearly marked
- [ ] Preview updates based on mapping

---

### TC-20.2.5: Auto-Detection of Common Fields

**Steps:**
1. Upload a CSV with columns named "First Name", "Last Name", "Email"
2. View the field mapping screen

**Expected Results:**
- [ ] "First Name" auto-maps to first_name field
- [ ] "Last Name" auto-maps to last_name field
- [ ] "Email" auto-maps to email field
- [ ] User can override auto-mappings

---

### TC-20.2.6: Preview with Validation

**Steps:**
1. Complete field mapping
2. Click "Preview Import"
3. Review the validation results

**Expected Results:**
- [ ] Preview shows all rows to be imported
- [ ] Valid rows show green/success indicator
- [ ] Invalid rows show red/error indicator
- [ ] Error details shown for each invalid row
- [ ] Line numbers reference original file

---

### TC-20.2.7: Validation Error - Missing Required Field

**Steps:**
1. Upload a file with some rows missing email addresses
2. Complete mapping
3. Preview the import

**Expected Results:**
- [ ] Rows with missing email are flagged
- [ ] Error message specifies "Missing required field: email"
- [ ] Line number is shown
- [ ] Import can proceed with valid rows only

---

### TC-20.2.8: Validation Error - Invalid Email Format

**Steps:**
1. Upload a file with invalid email formats
2. Complete mapping and preview

**Expected Results:**
- [ ] Invalid email rows are flagged
- [ ] Error message specifies "Invalid email format"
- [ ] Shows the actual invalid value
- [ ] Suggests correction if possible

---

### TC-20.2.9: Validation Error - Duplicate Email

**Steps:**
1. Upload a file with duplicate email addresses
2. Complete mapping and preview

**Expected Results:**
- [ ] Duplicate rows are flagged
- [ ] Error indicates "Duplicate email in file" or "Email already exists"
- [ ] Both duplicate rows are identified
- [ ] User can choose how to handle

---

### TC-20.2.10: Execute Full Import

**Steps:**
1. Upload a valid file with no errors
2. Complete mapping
3. Preview shows all valid
4. Click "Import"

**Expected Results:**
- [ ] Import processes successfully
- [ ] Progress bar shows during import
- [ ] Success message with count of imported records
- [ ] Employees appear in employee list
- [ ] Import logged in history

---

### TC-20.2.11: Partial Import (Skip Errors)

**Steps:**
1. Upload a file with mix of valid and invalid rows
2. Complete mapping and preview
3. Select "Skip errors and import valid rows"
4. Click "Import"

**Expected Results:**
- [ ] Only valid rows are imported
- [ ] Invalid rows are skipped
- [ ] Summary shows "X imported, Y skipped"
- [ ] Error report available for download
- [ ] Skipped rows can be corrected and re-imported

---

### TC-20.2.12: Cancel Import Before Execution

**Steps:**
1. Upload a file
2. Complete mapping
3. Click "Cancel" instead of "Import"

**Expected Results:**
- [ ] Import is cancelled
- [ ] No data is imported
- [ ] Redirected to import index
- [ ] Can start a new import

---

### TC-20.2.13: Import Large File

**Steps:**
1. Upload a CSV with 500+ employee records
2. Complete mapping and import

**Expected Results:**
- [ ] File processes without timeout
- [ ] Progress indicator works correctly
- [ ] Import completes successfully
- [ ] All records are imported
- [ ] Performance is acceptable

---

### TC-20.2.14: Handle Special Characters

**Steps:**
1. Upload a file with names containing special characters (accents, etc.)
2. Complete mapping and import

**Expected Results:**
- [ ] Special characters are preserved correctly
- [ ] Names like "Jos" and "Muller" import correctly
- [ ] No encoding errors
- [ ] Data displays correctly in the UI

---

### TC-20.2.15: Download Error Report

**Steps:**
1. Complete an import with some errors
2. Find and click "Download Error Report"

**Expected Results:**
- [ ] Error report downloads as CSV/Excel
- [ ] Contains all rows that failed
- [ ] Includes error reason for each row
- [ ] Original line numbers included
- [ ] Can be used to fix and re-import

---

## Notes

- Record any bugs or issues found during testing
- Note the browser and device used for testing
- Test with files from different sources (Excel, Google Sheets export, etc.)
- Verify imported data matches source data exactly
