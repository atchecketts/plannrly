# UAT: Feature 12.3 - Payment Method Management

## Test Environment Setup

**Prerequisites:**
- Stripe test mode configured
- Tenant with existing subscription
- Multiple test card numbers

**Test URLs:**
- Payment Methods: `/subscription/payment-method`

**Test Card Numbers:**
- Visa: 4242 4242 4242 4242
- Mastercard: 5555 5555 5555 4444
- Amex: 3782 822463 10005
- Declined: 4000 0000 0000 0002

---

## Test Cases

### TC-12.3.1: Payment Method Page Loads

**Steps:**
1. Log in as tenant with subscription
2. Navigate to payment method page

**Expected Results:**
- [ ] Page loads without errors
- [ ] Current payment method(s) displayed
- [ ] Card last 4 digits shown
- [ ] Expiry date shown
- [ ] Card brand displayed

---

### TC-12.3.2: Stripe Elements Card Input

**Steps:**
1. Navigate to payment method page
2. Look for card input field

**Expected Results:**
- [ ] Stripe Elements card field visible
- [ ] Field accepts card number input
- [ ] Field shows card brand icon
- [ ] Expiry and CVC fields present

---

### TC-12.3.3: Add New Payment Method

**Steps:**
1. Navigate to payment method page
2. Enter new test card details (5555 5555 5555 4444)
3. Enter valid expiry and CVC
4. Click "Add Payment Method"

**Expected Results:**
- [ ] Card validates successfully
- [ ] Payment method added
- [ ] New card appears in list
- [ ] Success message shown

---

### TC-12.3.4: Add Invalid Card

**Steps:**
1. Navigate to payment method page
2. Enter invalid card number (1234 5678 9012 3456)
3. Try to submit

**Expected Results:**
- [ ] Validation error shown
- [ ] Clear error message
- [ ] Card not added
- [ ] Can try again

---

### TC-12.3.5: Add Declined Card

**Steps:**
1. Navigate to payment method page
2. Enter declined test card (4000 0000 0000 0002)
3. Try to submit

**Expected Results:**
- [ ] Card declined message
- [ ] Payment method not saved
- [ ] User can try different card

---

### TC-12.3.6: Set Default Payment Method

**Steps:**
1. Add multiple payment methods
2. Click "Set as Default" on non-default card

**Expected Results:**
- [ ] Default indicator moves to new card
- [ ] Previous default no longer marked
- [ ] Change confirmed with message
- [ ] Stripe customer updated

---

### TC-12.3.7: Remove Payment Method

**Steps:**
1. Have multiple payment methods
2. Click "Remove" on non-default card
3. Confirm removal

**Expected Results:**
- [ ] Card removed from list
- [ ] Confirmation message shown
- [ ] Card removed from Stripe
- [ ] Other cards remain

---

### TC-12.3.8: Cannot Remove Only Payment Method

**Steps:**
1. Have only one payment method
2. Try to remove it

**Expected Results:**
- [ ] Error message shown
- [ ] Card not removed
- [ ] Message explains need for at least one method
- [ ] Or suggests adding new card first

---

### TC-12.3.9: Cannot Remove Default (Only) Method

**Steps:**
1. Have one payment method (which is default)
2. Try to remove it

**Expected Results:**
- [ ] Prevented from removing
- [ ] Clear error message
- [ ] Subscription requires payment method

---

### TC-12.3.10: Payment Method Display Format

**Steps:**
1. Navigate to payment methods
2. Review display of existing cards

**Expected Results:**
- [ ] Card brand displayed (Visa, Mastercard, etc.)
- [ ] Last 4 digits shown (****1234)
- [ ] Expiry shown (MM/YY)
- [ ] Default indicator clear
- [ ] Remove/actions visible

---

### TC-12.3.11: Update Payment Method Before Renewal

**Steps:**
1. Have subscription nearing renewal
2. Add new payment method
3. Set as default

**Expected Results:**
- [ ] New card set as default
- [ ] Next billing will use new card
- [ ] Old card can be removed

---

### TC-12.3.12: Mobile Payment Method Form

**Steps:**
1. Access payment method page on mobile
2. Add a new card

**Expected Results:**
- [ ] Stripe Elements responsive
- [ ] Card input works on mobile keyboard
- [ ] Form submits correctly
- [ ] Success/error messages visible

---

## Notes

- Always use Stripe test mode cards
- Test different card brands
- Verify changes reflected in Stripe Dashboard
- Check for PCI compliance (no raw card data in logs)
- Test form validation for incomplete entries
