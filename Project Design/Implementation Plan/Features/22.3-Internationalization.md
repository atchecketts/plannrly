# Feature 22.3: Internationalization

**Status:** Not Started
**Effort:** Medium
**Phase:** 22 - Data Retention & Notifications

## Overview

Support for 6 EU languages (English, Spanish, French, German, Italian, Portuguese) with proper localization of dates, times, numbers, and currencies. This enables Plannrly to serve businesses across Europe.

## Requirements

### Supported Languages
- English (en) - Default
- Spanish (es) - Spain
- French (fr) - France
- German (de) - Germany
- Italian (it) - Italy
- Portuguese (pt) - Portugal

### Localization Scope
- All UI strings
- Date and time formats
- Number formats
- Currency formats
- Email templates
- Error messages
- Validation messages

### Configuration Levels
- **Tenant default** - Organization-wide default
- **User preference** - Individual user override
- **Browser detection** - Fallback for new users

## Files

### To Create
- `app/Models/TenantLocale.php`
- `app/Services/LocalizationService.php`
- `app/Http/Middleware/SetLocale.php`
- `config/locales.php`
- `lang/es/auth.php`
- `lang/es/pagination.php`
- `lang/es/passwords.php`
- `lang/es/validation.php`
- `lang/es/messages.php`
- `lang/fr/auth.php`
- `lang/fr/pagination.php`
- `lang/fr/passwords.php`
- `lang/fr/validation.php`
- `lang/fr/messages.php`
- `lang/de/auth.php`
- `lang/de/pagination.php`
- `lang/de/passwords.php`
- `lang/de/validation.php`
- `lang/de/messages.php`
- `lang/it/auth.php`
- `lang/it/pagination.php`
- `lang/it/passwords.php`
- `lang/it/validation.php`
- `lang/it/messages.php`
- `lang/pt/auth.php`
- `lang/pt/pagination.php`
- `lang/pt/passwords.php`
- `lang/pt/validation.php`
- `lang/pt/messages.php`
- `resources/views/settings/locale.blade.php`
- `resources/views/profile/language.blade.php`
- `database/migrations/xxxx_add_locale_to_users_table.php`
- `database/migrations/xxxx_create_tenant_locales_table.php`
- `tests/Feature/LocalizationTest.php`

### To Modify
- `app/Models/User.php` - Add locale and timezone fields
- `bootstrap/app.php` - Register SetLocale middleware
- `app/Models/TenantSettings.php` - Add default_locale

### Routes
```php
// Tenant locale settings
Route::get('settings/locale', [LocaleController::class, 'edit'])->name('settings.locale');
Route::put('settings/locale', [LocaleController::class, 'update'])->name('settings.locale.update');

// User language preference
Route::get('profile/language', [ProfileController::class, 'language'])->name('profile.language');
Route::put('profile/language', [ProfileController::class, 'updateLanguage'])->name('profile.language.update');

// API locale switch (for SPA if needed)
Route::post('locale/{locale}', [LocaleController::class, 'switch'])->name('locale.switch');
```

## Configuration

### config/locales.php
```php
return [
    'available' => [
        'en' => [
            'name' => 'English',
            'native' => 'English',
            'flag' => 'gb',
            'date_format' => 'd/m/Y',
            'time_format' => 'H:i',
            'first_day_of_week' => 1, // Monday
            'currency' => 'GBP',
        ],
        'es' => [
            'name' => 'Spanish',
            'native' => 'Espanol',
            'flag' => 'es',
            'date_format' => 'd/m/Y',
            'time_format' => 'H:i',
            'first_day_of_week' => 1,
            'currency' => 'EUR',
        ],
        'fr' => [
            'name' => 'French',
            'native' => 'Francais',
            'flag' => 'fr',
            'date_format' => 'd/m/Y',
            'time_format' => 'H:i',
            'first_day_of_week' => 1,
            'currency' => 'EUR',
        ],
        'de' => [
            'name' => 'German',
            'native' => 'Deutsch',
            'flag' => 'de',
            'date_format' => 'd.m.Y',
            'time_format' => 'H:i',
            'first_day_of_week' => 1,
            'currency' => 'EUR',
        ],
        'it' => [
            'name' => 'Italian',
            'native' => 'Italiano',
            'flag' => 'it',
            'date_format' => 'd/m/Y',
            'time_format' => 'H:i',
            'first_day_of_week' => 1,
            'currency' => 'EUR',
        ],
        'pt' => [
            'name' => 'Portuguese',
            'native' => 'Portugues',
            'flag' => 'pt',
            'date_format' => 'd/m/Y',
            'time_format' => 'H:i',
            'first_day_of_week' => 1,
            'currency' => 'EUR',
        ],
    ],
    'default' => 'en',
    'fallback' => 'en',
];
```

## Database Schema

### users table changes
| Column | Type | Description |
|--------|------|-------------|
| locale | string | User's preferred locale |
| timezone | string | User's timezone |

### tenant_locales
| Column | Type | Description |
|--------|------|-------------|
| id | bigint | Primary key |
| tenant_id | bigint | Foreign key to tenants |
| default_locale | string | Tenant default locale |
| available_locales | json | Locales enabled for tenant |
| date_format | string | Override date format |
| time_format | string | Override time format |
| created_at | timestamp | |
| updated_at | timestamp | |

## Localization Service

```php
class LocalizationService
{
    public function formatDate(Carbon $date, ?string $format = null): string;
    public function formatTime(Carbon $time, ?string $format = null): string;
    public function formatDateTime(Carbon $dateTime): string;
    public function formatCurrency(float $amount, ?string $currency = null): string;
    public function formatNumber(float $number, int $decimals = 2): string;
    public function getFirstDayOfWeek(): int;
    public function getAvailableLocales(): array;
    public function getCurrentLocale(): string;
}
```

## Translation Categories

### messages.php (per language)
- Navigation labels
- Button text
- Form labels
- Status messages
- Confirmation dialogs
- Success/error messages
- Schedule-related terms
- Leave management terms
- Employee management terms

## Tasks

- [ ] Create locale configuration file
- [ ] Create user locale migration
- [ ] Create tenant_locales migration
- [ ] Create TenantLocale model
- [ ] Create LocalizationService
- [ ] Create SetLocale middleware
- [ ] Register middleware in bootstrap/app.php
- [ ] Extract all UI strings to translation files
- [ ] Create English translations (baseline)
- [ ] Create Spanish translations
- [ ] Create French translations
- [ ] Create German translations
- [ ] Create Italian translations
- [ ] Create Portuguese translations
- [ ] Add language selector to user preferences
- [ ] Add default locale to tenant settings
- [ ] Implement browser locale detection
- [ ] Localize email templates
- [ ] Localize date/time formatting
- [ ] Localize currency formatting
- [ ] Write comprehensive tests

## Tests

Planned tests for `tests/Feature/LocalizationTest.php`:

1. `test_user_can_set_locale_preference`
2. `test_tenant_can_set_default_locale`
3. `test_user_locale_overrides_tenant_default`
4. `test_middleware_sets_app_locale`
5. `test_dates_formatted_per_locale`
6. `test_times_formatted_per_locale`
7. `test_currencies_formatted_per_locale`
8. `test_translation_files_complete`
9. `test_fallback_to_english_for_missing`
10. `test_browser_detection_sets_initial_locale`
11. `test_email_uses_recipient_locale`
12. `test_different_tenants_different_locales`

## Dependencies

- Laravel Localization
- Carbon for date formatting
- NumberFormatter for number/currency
- Tenant model
- User model
