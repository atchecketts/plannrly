# Feature 2.3: Recurring Shift Templates

**Status:** Complete
**Completed:** January 2026
**Effort:** Medium
**Phase:** 2 - Scheduling Features

## Overview

The schema supports recurring shifts but no UI exists. This feature adds the user interface for creating and managing recurring shift patterns, allowing managers to set up repeating shifts that automatically generate instances.

## Requirements

### Functional Requirements
- Recurrence options in shift create/edit modal
- Recurrence rule builder UI (daily, weekly, monthly)
- Ability to edit single instance vs all instances
- Proper handling of deletion for recurring shifts
- Command to generate and extend recurring shift instances

### Technical Requirements
- Recurrence rule storage (using existing schema)
- RecurringShiftService for generating shift instances
- UI for managing recurring patterns
- Daily scheduled command for extending recurring shifts

## Implementation Details

### Key Design Decisions

| Decision | Choice | Rationale |
|----------|--------|-----------|
| Generation timing | Immediate on creation | User sees shifts instantly for verification |
| Generation range | 12 weeks ahead (configurable) | Prevents creating thousands; maintenance command extends |
| Edit scope | Choice: "this instance" or "all future" | Explicit user control, safe default |
| Delete scope | Choice: "this instance" or "all future" | Same pattern as edit |
| Monthly handling | Same day of month | Skip months where day doesn't exist |

### Recurrence Rule Schema

```json
{
    "frequency": "weekly",
    "interval": 1,
    "days_of_week": [1, 3, 5],
    "end_date": "2026-06-30",
    "end_after_occurrences": 52
}
```

## Files

### Created
- `app/Services/RecurringShiftService.php` - Core service with generation logic
- `app/Console/Commands/ExtendRecurringShiftsCommand.php` - Daily command to extend generation window
- `tests/Feature/RecurringShiftTest.php` - Comprehensive tests

### Modified
- `app/Models/Shift.php` - Added helper methods (isRecurringParent, isRecurringChild, etc.)
- `app/Http/Controllers/ShiftController.php` - Handle store/update/destroy with recurrence
- `app/Http/Requests/Shift/UpdateShiftRequest.php` - Added edit_scope and recurrence validation
- `resources/views/components/shift-edit-modal.blade.php` - Added recurrence UI section
- `resources/views/schedule/index.blade.php` - Added recurrence state, toggleDayOfWeek, visual indicator
- `database/factories/ShiftFactory.php` - Added recurring() and childOf() states
- `routes/console.php` - Scheduled extend command daily

## Tasks

- [x] Add recurrence options to shift create/edit modal
- [x] Implement recurrence rule builder UI (daily, weekly, monthly)
- [x] Create RecurringShiftService for generating shift instances
- [x] Add ability to edit single instance vs all instances
- [x] Handle deletion of recurring shifts (single/future scope)
- [x] Create ExtendRecurringShiftsCommand for extending generation window
- [x] Add visual indicator (recurring icon) on shift blocks
- [x] Add factory states for testing
- [x] Write comprehensive tests

## Dependencies

- Shift model with recurrence fields (pre-existing)
- ShiftController
- Shift edit modal component
- Laravel scheduler

## User Interface

### Recurrence Section in Modal
- Toggle to enable recurring
- Frequency dropdown (Daily/Weekly/Monthly)
- Interval input ("Every N days/weeks/months")
- Days of week toggles (for weekly - Sun through Sat)
- End condition radios:
  - Never (extends automatically)
  - On date (date picker)
  - After N occurrences

### Edit/Delete Scope Selection
For existing recurring shifts:
- "This shift only" - Detaches from series
- "This and all future shifts" - Bulk update/delete

### Visual Indicator
- Recurring shifts display a small refresh icon next to the times
