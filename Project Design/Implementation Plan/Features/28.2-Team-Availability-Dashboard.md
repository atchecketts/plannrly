# Feature 28.2: Team Availability Dashboard

**Status:** Not Started
**Effort:** Medium
**Phase:** 28 - Workflows & Visibility

## Overview

Comprehensive view for planning and gap analysis. Provides managers with a unified calendar view showing team availability, scheduled shifts, leave, and employee preferences to facilitate better scheduling decisions.

## Requirements

### Functional Requirements

#### Unified Availability View
- Calendar view showing all team members
- Display scheduled shifts with employee names
- Show approved leave with leave type
- Indicate employee preferences/availability
- Show certifications/skills per employee

#### Gap Analysis
- Identify understaffed periods automatically
- Highlight shifts without coverage
- Show skill gaps for specific shifts
- Compare required vs available staff

#### Quick Actions
- Assign employees to shifts from availability view
- View employee details on hover/click
- Filter by role, department, skills
- Export availability for external planning

#### Time Range Options
- Daily view with hourly breakdown
- Weekly view (default)
- Monthly overview
- Custom date range

### Authorization
- Admins see all employees
- Managers see their department/team
- Employees can view their own availability

## Files

### To Create
- `app/Services/TeamAvailabilityService.php`
- `app/Services/GapAnalysisService.php`
- `app/Http/Controllers/TeamAvailabilityController.php`
- `app/Data/EmployeeAvailability.php`
- `app/Data/GapAnalysisResult.php`
- `resources/views/team/availability/index.blade.php`
- `resources/views/team/availability/daily.blade.php`
- `resources/views/team/availability/weekly.blade.php`
- `resources/views/team/availability/monthly.blade.php`
- `resources/views/components/availability-calendar.blade.php`
- `resources/views/components/availability-legend.blade.php`
- `resources/views/components/gap-indicator.blade.php`
- `tests/Feature/TeamAvailabilityTest.php`

### Routes
```php
Route::get('team/availability', [TeamAvailabilityController::class, 'index'])->name('team.availability');
Route::get('team/availability/daily', [TeamAvailabilityController::class, 'daily'])->name('team.availability.daily');
Route::get('team/availability/weekly', [TeamAvailabilityController::class, 'weekly'])->name('team.availability.weekly');
Route::get('team/availability/monthly', [TeamAvailabilityController::class, 'monthly'])->name('team.availability.monthly');
Route::get('team/availability/gaps', [TeamAvailabilityController::class, 'gaps'])->name('team.availability.gaps');
Route::get('team/availability/export', [TeamAvailabilityController::class, 'export'])->name('team.availability.export');
Route::post('team/availability/quick-assign', [TeamAvailabilityController::class, 'quickAssign'])->name('team.availability.quick-assign');
```

## Tasks

- [ ] Create TeamAvailabilityService for aggregating data
- [ ] Create GapAnalysisService for identifying coverage gaps
- [ ] Create EmployeeAvailability data transfer object
- [ ] Create GapAnalysisResult data transfer object
- [ ] Build calendar view of team availability
- [ ] Show leave, shifts, preferences in unified view
- [ ] Implement skill/certification visibility
- [ ] Create gap analysis for understaffed periods
- [ ] Add quick-assign from availability view
- [ ] Implement daily/weekly/monthly views
- [ ] Add filtering by role, department, skills
- [ ] Create export functionality (CSV/Excel)
- [ ] Write tests

## EmployeeAvailability Data Object

```php
class EmployeeAvailability
{
    public function __construct(
        public User $employee,
        public Carbon $date,
        public ?Shift $scheduledShift,
        public ?LeaveRequest $leave,
        public ?AvailabilityPreference $preference,
        public Collection $skills,
        public bool $isAvailable,
        public ?string $unavailableReason,
    ) {}
}
```

## Gap Analysis Result

```php
class GapAnalysisResult
{
    public function __construct(
        public Carbon $startTime,
        public Carbon $endTime,
        public int $requiredStaff,
        public int $availableStaff,
        public int $shortfall,
        public array $missingSkills,
        public Collection $availableEmployees,
    ) {}
}
```

## Availability Display

| Status | Visual | Description |
|--------|--------|-------------|
| Scheduled | Blue | Has a shift assigned |
| On Leave | Yellow | Approved leave |
| Available | Green | No conflicts, willing to work |
| Unavailable | Red | Has conflict or preference |
| Partial | Orange | Available part of the day |

## Tests

Expected tests in `tests/Feature/TeamAvailabilityTest.php`:

1. `test_manager_can_view_team_availability`
2. `test_employee_cannot_view_full_team_availability`
3. `test_availability_shows_scheduled_shifts`
4. `test_availability_shows_approved_leave`
5. `test_availability_shows_preferences`
6. `test_gap_analysis_identifies_understaffing`
7. `test_gap_analysis_identifies_skill_gaps`
8. `test_quick_assign_creates_shift`
9. `test_filter_by_department_works`
10. `test_filter_by_skills_works`
11. `test_export_generates_csv`
12. `test_daily_view_shows_hourly_breakdown`

## Dependencies

- User model
- Shift model
- LeaveRequest model
- AvailabilityPreference model (if exists)
- Skill/Certification model (if exists)
- BusinessRole model
