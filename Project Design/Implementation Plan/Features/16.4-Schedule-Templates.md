# Feature 16.4: Schedule Templates

**Status:** Not Started
**Effort:** Large
**Phase:** 16 - Scheduling Enhancements

## Overview

Save and reuse schedule patterns as templates. Managers can save a week's schedule as a template and apply it to future weeks, with smart employee matching.

## Requirements

### Functional Requirements
- Save current schedule (or portion) as a template
- Create template library view
- Categorize templates (standard, seasonal, holiday, etc.)
- Apply template to a future week
- Smart employee matching by role when applying
- Share templates across locations
- Import/export templates

### Template Structure
- Template name and description
- Category
- List of shifts with times and roles (not specific employees)
- Notes and requirements per shift

### Application Process
1. Select template to apply
2. Choose target week
3. System suggests employees based on role, availability
4. Manager reviews and adjusts
5. Confirm to create shifts

### UI Components
- Template library list
- Save as template button in schedule view
- Category filter
- Template preview
- Apply template wizard

## Files

### To Create
- `app/Models/ScheduleTemplate.php` - Template model
- `app/Models/ScheduleTemplateShift.php` - Template shift model
- `app/Services/ScheduleTemplateService.php` - Business logic
- `app/Http/Controllers/ScheduleTemplateController.php` - Controller
- `database/migrations/xxxx_create_schedule_templates_table.php`
- `database/migrations/xxxx_create_schedule_template_shifts_table.php`
- `resources/views/schedule-templates/index.blade.php` - Library view
- `resources/views/schedule-templates/create.blade.php` - Create/edit form
- `tests/Feature/ScheduleTemplatesTest.php` - Feature tests

### Routes
```php
Route::resource('schedule-templates', ScheduleTemplateController::class);
Route::post('schedule-templates/{template}/apply', [ScheduleTemplateController::class, 'apply'])->name('schedule-templates.apply');
Route::post('schedule-templates/from-week', [ScheduleTemplateController::class, 'createFromWeek'])->name('schedule-templates.from-week');
Route::get('schedule-templates/{template}/export', [ScheduleTemplateController::class, 'export'])->name('schedule-templates.export');
Route::post('schedule-templates/import', [ScheduleTemplateController::class, 'import'])->name('schedule-templates.import');
```

## Database Schema

### schedule_templates
```php
Schema::create('schedule_templates', function (Blueprint $table) {
    $table->id();
    $table->foreignId('tenant_id')->constrained()->cascadeOnDelete();
    $table->foreignId('location_id')->nullable()->constrained()->nullOnDelete();
    $table->string('name');
    $table->text('description')->nullable();
    $table->string('category')->nullable(); // standard, seasonal, holiday
    $table->boolean('is_shared')->default(false); // Share across locations
    $table->foreignId('created_by')->constrained('users')->cascadeOnDelete();
    $table->timestamps();
});
```

### schedule_template_shifts
```php
Schema::create('schedule_template_shifts', function (Blueprint $table) {
    $table->id();
    $table->foreignId('schedule_template_id')->constrained()->cascadeOnDelete();
    $table->tinyInteger('day_of_week'); // 0-6
    $table->time('start_time');
    $table->time('end_time');
    $table->foreignId('business_role_id')->nullable()->constrained()->nullOnDelete();
    $table->foreignId('location_id')->nullable()->constrained()->nullOnDelete();
    $table->text('notes')->nullable();
    $table->integer('required_count')->default(1); // Number of employees needed
    $table->timestamps();
});
```

## Tasks

- [ ] Create template migrations
- [ ] Save current schedule as template
- [ ] Create template library view
- [ ] Categorize templates (standard, seasonal, etc.)
- [ ] Apply template to future week
- [ ] Smart employee matching by role
- [ ] Share templates across locations
- [ ] Import/export templates
- [ ] Write tests

## Tests

Suggested tests for `tests/Feature/ScheduleTemplatesTest.php`:

1. `test_admin_can_view_template_library`
2. `test_admin_can_create_template`
3. `test_admin_can_save_schedule_as_template`
4. `test_template_captures_shift_details`
5. `test_admin_can_apply_template_to_week`
6. `test_apply_template_matches_employees_by_role`
7. `test_template_categories_work`
8. `test_shared_templates_visible_across_locations`
9. `test_admin_can_export_template`
10. `test_admin_can_import_template`
11. `test_employee_cannot_manage_templates`

## Dependencies

- Shift model
- BusinessRole model
- Location model
- User model with roles
- Availability service for employee matching
