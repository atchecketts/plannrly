# Feature 8.2: Data Export

**Status:** Not Started
**Effort:** Medium
**Phase:** 8 - Data Import/Export

## Overview

Enable administrators to export various data from the system in CSV and PDF formats. This supports reporting, external analysis, payroll integration, and record-keeping requirements.

## Requirements

### Functional Requirements
- Export schedules to CSV and PDF
- Export employee list to CSV
- Export timesheets to CSV (for payroll)
- Export leave reports to CSV and PDF
- Add export buttons to relevant pages
- Support date range filtering for exports
- Support department/location filtering

### Export Types
| Export | Formats | Filters |
|--------|---------|---------|
| Schedule | CSV, PDF | Date range, Department, Location |
| Employee List | CSV | Department, Status, Role |
| Timesheet | CSV | Date range, Department, Employee |
| Leave Report | CSV, PDF | Date range, Department, Leave type |

### Business Rules
- Only admins can export data
- Large exports should be queued and emailed when complete
- Exports should respect data visibility permissions
- PDF exports should be formatted for printing
- CSV exports should be compatible with common spreadsheet software

## Files

### To Create
- `app/Http/Controllers/ExportController.php`
- `app/Http/Requests/Export/ScheduleExportRequest.php`
- `app/Http/Requests/Export/EmployeeExportRequest.php`
- `app/Http/Requests/Export/TimesheetExportRequest.php`
- `app/Http/Requests/Export/LeaveExportRequest.php`
- `app/Exports/ScheduleExport.php`
- `app/Exports/EmployeeExport.php`
- `app/Exports/TimesheetExport.php`
- `app/Exports/LeaveReportExport.php`
- `app/Jobs/ProcessLargeExport.php`
- `resources/views/exports/schedule-pdf.blade.php`
- `resources/views/exports/leave-report-pdf.blade.php`
- `tests/Feature/DataExportTest.php`

### Routes
```php
Route::prefix('export')->group(function () {
    Route::get('schedule', [ExportController::class, 'scheduleForm'])->name('export.schedule.form');
    Route::post('schedule', [ExportController::class, 'schedule'])->name('export.schedule');
    Route::get('employees', [ExportController::class, 'employeesForm'])->name('export.employees.form');
    Route::post('employees', [ExportController::class, 'employees'])->name('export.employees');
    Route::get('timesheet', [ExportController::class, 'timesheetForm'])->name('export.timesheet.form');
    Route::post('timesheet', [ExportController::class, 'timesheet'])->name('export.timesheet');
    Route::get('leave', [ExportController::class, 'leaveForm'])->name('export.leave.form');
    Route::post('leave', [ExportController::class, 'leave'])->name('export.leave');
});
```

## Tasks

- [ ] Create ExportController
- [ ] Create export request validation classes
- [ ] Implement ScheduleExport (CSV and PDF)
- [ ] Implement EmployeeExport (CSV)
- [ ] Implement TimesheetExport (CSV)
- [ ] Implement LeaveReportExport (CSV and PDF)
- [ ] Create PDF templates for schedule and leave report
- [ ] Implement ProcessLargeExport job for queued exports
- [ ] Add export buttons to schedule view
- [ ] Add export buttons to employee list
- [ ] Add export buttons to timesheet view
- [ ] Add export buttons to leave management
- [ ] Add date range and filter options to export forms
- [ ] Write tests

## Export Formats

### Schedule CSV Columns
- Date, Day, Shift Name, Start Time, End Time, Employee Name, Department, Location, Role

### Employee CSV Columns
- ID, First Name, Last Name, Email, Phone, Department, Roles, Status, Start Date, Hourly Rate

### Timesheet CSV Columns
- Employee ID, Employee Name, Date, Scheduled Start, Scheduled End, Actual Start, Actual End, Hours Worked, Overtime Hours

### Leave Report CSV Columns
- Employee ID, Employee Name, Leave Type, Start Date, End Date, Days, Status, Approved By, Notes

## Tests

Tests to be created in `tests/Feature/DataExportTest.php`:

1. `test_admin_can_export_schedule_csv`
2. `test_admin_can_export_schedule_pdf`
3. `test_schedule_export_respects_date_filter`
4. `test_admin_can_export_employee_list`
5. `test_employee_export_respects_department_filter`
6. `test_admin_can_export_timesheet`
7. `test_timesheet_export_calculates_hours_correctly`
8. `test_admin_can_export_leave_report_csv`
9. `test_admin_can_export_leave_report_pdf`
10. `test_non_admin_cannot_export_data`
11. `test_large_export_is_queued`

## Dependencies

- Schedule model
- Shift model
- User model
- LeaveRequest model
- Laravel Excel package (for CSV exports)
- DomPDF or similar (for PDF exports)
- Queue system for large exports
