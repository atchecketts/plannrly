# Feature 15.1: Data Export (Right to Access)

**Status:** Not Started
**Effort:** Medium
**Phase:** 15 - GDPR Compliance

## Overview

Allow users to export their personal data in compliance with GDPR Article 15 (Right of Access). Users can request and download all personal data the system holds about them.

## Requirements

### Functional Requirements
- Users can request export of all their personal data
- Generate JSON export file with all user data
- Generate CSV export option for tabular data
- Process large exports in background job
- Email download link when export is ready
- Log all export requests in audit trail
- Include all related data (shifts, time entries, leave requests, etc.)

### Data to Include
- User profile information
- Shift history
- Time entries
- Leave requests
- Availability records
- Shift swap history
- Settings and preferences

### UI Components
- Export request button in user settings
- Export format selection (JSON, CSV)
- Request status indicator
- Download link when ready

## Files

### To Create
- `app/Services/GdprDataExportService.php` - Export logic
- `app/Http/Controllers/DataExportController.php` - Controller
- `app/Jobs/GenerateDataExportJob.php` - Background job
- `app/Notifications/DataExportReadyNotification.php` - Email notification
- `resources/views/settings/data-export.blade.php` - Export UI
- `tests/Feature/GdprDataExportTest.php` - Feature tests

### Routes
```php
Route::get('settings/data-export', [DataExportController::class, 'index'])->name('settings.data-export');
Route::post('settings/data-export/request', [DataExportController::class, 'request'])->name('settings.data-export.request');
Route::get('settings/data-export/download/{token}', [DataExportController::class, 'download'])->name('settings.data-export.download');
```

## Tasks

- [ ] Create GdprDataExportService
- [ ] Collect all user data (profile, shifts, time entries, etc.)
- [ ] Generate JSON export file
- [ ] Generate CSV export option
- [ ] Create background job for large exports
- [ ] Email download link when ready
- [ ] Add export request UI for employees
- [ ] Log all export requests in audit trail
- [ ] Write tests

## Export Format

### JSON Structure
```json
{
  "export_date": "2024-01-15T12:00:00Z",
  "user": {
    "id": 123,
    "name": "John Doe",
    "email": "john@example.com",
    "created_at": "2023-01-01T00:00:00Z"
  },
  "shifts": [...],
  "time_entries": [...],
  "leave_requests": [...],
  "availability": [...],
  "shift_swaps": [...],
  "settings": {...}
}
```

## Tests

Suggested tests for `tests/Feature/GdprDataExportTest.php`:

1. `test_user_can_view_data_export_page`
2. `test_user_can_request_data_export`
3. `test_export_includes_user_profile`
4. `test_export_includes_shift_history`
5. `test_export_includes_time_entries`
6. `test_export_includes_leave_requests`
7. `test_export_job_sends_email_when_ready`
8. `test_user_can_download_export_with_valid_token`
9. `test_download_link_expires_after_period`
10. `test_export_request_is_logged_in_audit_trail`

## Dependencies

- User model with all relationships
- Shift model
- TimeEntry model
- LeaveRequest model
- Availability model
- ShiftSwapRequest model
- AuditLogService (from 14.3)
- Mail system
