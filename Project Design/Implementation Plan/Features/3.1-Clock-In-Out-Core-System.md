# Feature 3.1: Clock In/Out Core System

**Status:** Pending
**Effort:** Large
**Phase:** 3 - Time & Attendance

## Overview

Enable employees to clock in and out of shifts with full time tracking. This is the core system for time and attendance, providing the foundation for all time tracking functionality including break management, GPS capture, and manager approval workflows.

## Requirements

### Functional Requirements
- Employees can clock in to their shifts
- Employees can clock out of their shifts
- Break tracking (start/end break)
- Manager adjustment functionality with reason
- Manager approval workflow (if tenant requires it)
- GPS location capture (if configured)
- Grace period validation for clock-in times

### Controller Actions
```
TimeEntryController:
- index()           - List time entries (admin: all, employee: own)
- show()            - View single time entry details
- clockIn()         - Employee clocks in
- clockOut()        - Employee clocks out
- startBreak()      - Start break
- endBreak()        - End break
- adjust()          - Manager adjusts time entry
- approve()         - Manager approves time entry
- currentStatus()   - Get current clock status (API)
```

## Files

### To Create
- `app/Http/Controllers/TimeEntryController.php`
- `app/Http/Requests/TimeEntry/ClockInRequest.php`
- `app/Http/Requests/TimeEntry/ClockOutRequest.php`
- `app/Http/Requests/TimeEntry/StartBreakRequest.php`
- `app/Http/Requests/TimeEntry/AdjustTimeEntryRequest.php`
- `app/Policies/TimeEntryPolicy.php`
- `app/Exceptions/ClockInException.php`
- `app/Exceptions/ClockOutException.php`
- `resources/views/time-entries/index.blade.php`
- `resources/views/time-entries/show.blade.php`
- `resources/views/components/clock-widget.blade.php`
- `tests/Feature/TimeEntryTest.php`
- `tests/Feature/ClockInOutTest.php`

### Database Migrations
Add columns to `time_entries` table:
- `approved_by` (bigint unsigned, nullable, FK to users)
- `approved_at` (timestamp, nullable)
- `adjustment_reason` (text, nullable)

Add columns to `tenant_settings` table:
- `clock_in_grace_minutes` (integer, default 15)
- `require_gps_clock_in` (boolean, default false)
- `auto_clock_out_enabled` (boolean, default false)
- `auto_clock_out_time` (time, default '23:59:00')
- `overtime_threshold_minutes` (integer, default 0)
- `require_manager_approval` (boolean, default false)

## Tasks

- [ ] Create TimeEntryController with all actions
- [ ] Create form request validation classes
- [ ] Create TimeEntryPolicy for authorization
- [ ] Implement clock-in logic with validations:
  - Check tenant has clock-in enabled
  - Check employee not already clocked in
  - Validate within grace period of shift start
  - Capture GPS location if required
- [ ] Implement clock-out logic with validations:
  - Check employee is currently clocked in
  - Calculate actual worked minutes
  - Capture GPS location if configured
- [ ] Implement break tracking (start/end break)
- [ ] Add manager adjustment functionality with reason
- [ ] Add manager approval workflow if tenant requires it
- [ ] Create time entries index view with filtering
- [ ] Add routes to web.php
- [ ] Write comprehensive tests

## Dependencies

- TimeEntry model
- Shift model
- User model
- TenantSettings model
- Tenant model
