# Feature 16.5: Smart Fill (Auto-Scheduling Assistant)

**Status:** Not Started
**Effort:** Large
**Phase:** 16 - Scheduling Enhancements

## Overview

One-click filling of unassigned shifts with intelligent employee suggestions. The system analyzes availability, qualifications, fairness, and preferences to suggest the best candidates for each open shift.

## Requirements

### Functional Requirements
- Find candidates based on availability and qualifications
- Rank candidates by fairness score
- Respect target hours and overtime limits
- Consider recent shifts for fairness
- Generate suggestions with alternatives
- Preview suggestions before applying
- Show warnings (overtime, preferences violated)

### Ranking Criteria
1. Qualified for the role
2. Available during shift time
3. Not exceeding target hours
4. Fairness score (even distribution)
5. Preference alignment
6. Recent shift history

### UI Components
- "Smart Fill" button in schedule view
- Suggestion preview modal
- Alternative candidates list
- Warning indicators
- Apply all / Apply selected buttons

## Files

### To Create
- `app/Services/SmartFillService.php` - Core logic
- `app/DTOs/SmartFillResult.php` - Result data object
- `app/DTOs/ShiftSuggestion.php` - Single suggestion DTO
- `tests/Feature/SmartFillTest.php` - Feature tests

### Routes
```php
Route::post('schedule/smart-fill', [ScheduleController::class, 'smartFill'])->name('schedule.smart-fill');
Route::post('schedule/smart-fill/apply', [ScheduleController::class, 'applySmartFill'])->name('schedule.smart-fill.apply');
```

## DTOs

### SmartFillResult
```php
class SmartFillResult
{
    public function __construct(
        public Collection $suggestions,
        public array $warnings,
        public int $filledCount,
        public int $unfilledCount,
    ) {}
}
```

### ShiftSuggestion
```php
class ShiftSuggestion
{
    public function __construct(
        public Shift $shift,
        public ?User $suggestedUser,
        public float $score,
        public array $alternativeUsers,
        public array $warnings,
        public string $reason,
    ) {}
}
```

## Smart Fill Algorithm

```
For each unassigned shift:
1. Get all users with matching role qualification
2. Filter by availability during shift time
3. Filter by not on leave
4. Score remaining candidates:
   - Base score: 100
   - Hours variance from target: -10 per hour over
   - Overtime warning: -20
   - Weekend balance: +/- 10
   - Preference match: +/- 5 to 15
   - Recent consecutive days: -5 per day
5. Sort by score descending
6. Select top candidate
7. Track for fairness in subsequent iterations
```

## Tasks

- [ ] Create SmartFillService
- [ ] Find candidates based on availability and qualifications
- [ ] Rank candidates by fairness score
- [ ] Respect target hours and overtime limits
- [ ] Consider recent shifts for fairness
- [ ] Generate suggestions with alternatives
- [ ] Add "Smart Fill" button to schedule view
- [ ] Preview suggestions before applying
- [ ] Show warnings (overtime, preferences)
- [ ] Write tests

## Tests

Suggested tests for `tests/Feature/SmartFillTest.php`:

1. `test_smart_fill_suggests_qualified_users`
2. `test_smart_fill_respects_availability`
3. `test_smart_fill_excludes_users_on_leave`
4. `test_smart_fill_considers_target_hours`
5. `test_smart_fill_warns_about_overtime`
6. `test_smart_fill_distributes_shifts_fairly`
7. `test_smart_fill_provides_alternatives`
8. `test_smart_fill_respects_preferences`
9. `test_admin_can_preview_suggestions`
10. `test_admin_can_apply_selected_suggestions`
11. `test_employee_cannot_access_smart_fill`

## Dependencies

- Shift model
- User model with roles and qualifications
- Availability model/service
- LeaveRequest model
- UserShiftPreference model (from 16.1)
- Fairness calculation logic
