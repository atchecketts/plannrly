# Feature 18.1: Schedule Fairness Analytics

**Status:** Not Started
**Effort:** Medium
**Phase:** 18 - Analytics Enhancements

## Overview

Measure and improve schedule fairness across the team. Provides visibility into how equitably shifts, weekends, holidays, and preferences are distributed among employees.

## Requirements

### Functional Requirements
- Calculate weekend distribution fairness
- Calculate holiday distribution fairness
- Calculate preference satisfaction score
- Calculate hours variance from target
- Track short-notice change impact
- Generate per-employee fairness score
- Show team fairness dashboard
- Warn when scheduling creates unfairness

### Fairness Metrics
| Metric | Description |
|--------|-------------|
| Weekend Balance | How evenly weekend shifts are distributed |
| Holiday Balance | How evenly holiday shifts are distributed |
| Preference Score | How well preferences are satisfied |
| Hours Variance | Deviation from target hours |
| Short Notice | Frequency of late schedule changes |

### UI Components
- Team fairness dashboard
- Per-employee fairness breakdown
- Trend charts over time
- Fairness warnings in scheduling view
- Detailed fairness report

## Files

### To Create
- `app/Services/FairnessAnalyticsService.php` - Analytics calculations
- `resources/views/analytics/fairness.blade.php` - Fairness dashboard
- `tests/Feature/ScheduleFairnessAnalyticsTest.php` - Feature tests

### Routes
```php
Route::get('analytics/fairness', [AnalyticsController::class, 'fairness'])->name('analytics.fairness');
Route::get('api/analytics/fairness', [AnalyticsController::class, 'fairnessData'])->name('api.analytics.fairness');
Route::get('api/analytics/fairness/user/{user}', [AnalyticsController::class, 'userFairness'])->name('api.analytics.fairness.user');
```

## Fairness Calculations

### Weekend Balance Score
```php
// Calculate standard deviation of weekend shifts per employee
$weekendShifts = $users->map(fn($user) => $user->getWeekendShiftCount($period));
$mean = $weekendShifts->average();
$variance = $weekendShifts->map(fn($count) => pow($count - $mean, 2))->average();
$stdDev = sqrt($variance);

// Convert to 0-100 score (lower stdDev = higher score)
$score = max(0, 100 - ($stdDev * 10));
```

### Per-Employee Fairness Score
```php
$score = weighted_average([
    'weekend_balance' => 0.25,
    'holiday_balance' => 0.20,
    'preference_satisfaction' => 0.25,
    'hours_variance' => 0.20,
    'short_notice_impact' => 0.10,
]);
```

## Tasks

- [ ] Create FairnessAnalyticsService
- [ ] Calculate weekend distribution fairness
- [ ] Calculate holiday distribution fairness
- [ ] Calculate preference satisfaction score
- [ ] Calculate hours variance from target
- [ ] Calculate short-notice change impact
- [ ] Generate per-employee fairness score
- [ ] Show team fairness dashboard
- [ ] Warn when scheduling creates unfairness
- [ ] Write tests

## Tests

Suggested tests for `tests/Feature/ScheduleFairnessAnalyticsTest.php`:

1. `test_admin_can_view_fairness_dashboard`
2. `test_weekend_balance_is_calculated`
3. `test_holiday_balance_is_calculated`
4. `test_preference_satisfaction_is_calculated`
5. `test_hours_variance_is_calculated`
6. `test_short_notice_impact_is_tracked`
7. `test_per_employee_fairness_score_is_calculated`
8. `test_unfairness_warning_is_shown`
9. `test_fairness_trend_is_tracked_over_time`
10. `test_employee_cannot_access_fairness_analytics`

## Dependencies

- User model
- Shift model
- UserShiftPreference model (from 16.1)
- TenantSettings for target hours
