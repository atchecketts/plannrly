# Feature 16.7: Shift Notes & Handover

**Status:** Not Started
**Effort:** Medium
**Phase:** 16 - Scheduling Enhancements

## Overview

Enable communication between shifts through notes, instructions, and task checklists. Managers can add instructions to shifts, and employees can leave handover notes for the next shift.

## Requirements

### Functional Requirements
- Managers can add instructions when creating/editing shifts
- Employees can add handover notes during or after their shift
- Create task checklists per shift
- Track task completion status
- Show handover notes to incoming shift employees
- Require acknowledgment for manager instructions

### Note Types
- **Manager Instructions**: Pre-shift instructions from manager
- **Handover Notes**: Post-shift notes for next employee
- **Task Items**: Checklist of tasks to complete

### UI Components
- Instructions field in shift create/edit form
- Handover notes section in shift detail view
- Task checklist with checkboxes
- Acknowledgment button for instructions
- Handover notes from previous shift display

## Files

### To Create
- `app/Models/ShiftNote.php` - Notes model
- `app/Models/ShiftTask.php` - Tasks model
- `app/Http/Controllers/ShiftNoteController.php` - Controller
- `database/migrations/xxxx_create_shift_notes_table.php`
- `database/migrations/xxxx_create_shift_tasks_table.php`
- `resources/views/shifts/notes.blade.php` - Notes view
- `tests/Feature/ShiftNotesHandoverTest.php` - Feature tests

### Routes
```php
Route::get('shifts/{shift}/notes', [ShiftNoteController::class, 'index'])->name('shifts.notes.index');
Route::post('shifts/{shift}/notes', [ShiftNoteController::class, 'store'])->name('shifts.notes.store');
Route::post('shifts/{shift}/acknowledge', [ShiftNoteController::class, 'acknowledge'])->name('shifts.acknowledge');
Route::post('shifts/{shift}/tasks', [ShiftNoteController::class, 'addTask'])->name('shifts.tasks.store');
Route::patch('shifts/{shift}/tasks/{task}', [ShiftNoteController::class, 'updateTask'])->name('shifts.tasks.update');
```

## Database Schema

### shift_notes
```php
Schema::create('shift_notes', function (Blueprint $table) {
    $table->id();
    $table->foreignId('shift_id')->constrained()->cascadeOnDelete();
    $table->foreignId('user_id')->constrained()->cascadeOnDelete();
    $table->enum('type', ['instruction', 'handover', 'general']);
    $table->text('content');
    $table->boolean('requires_acknowledgment')->default(false);
    $table->timestamp('acknowledged_at')->nullable();
    $table->foreignId('acknowledged_by')->nullable()->constrained('users')->nullOnDelete();
    $table->timestamps();
});
```

### shift_tasks
```php
Schema::create('shift_tasks', function (Blueprint $table) {
    $table->id();
    $table->foreignId('shift_id')->constrained()->cascadeOnDelete();
    $table->string('title');
    $table->text('description')->nullable();
    $table->boolean('is_completed')->default(false);
    $table->foreignId('completed_by')->nullable()->constrained('users')->nullOnDelete();
    $table->timestamp('completed_at')->nullable();
    $table->integer('sort_order')->default(0);
    $table->timestamps();
});
```

## Tasks

- [ ] Create shift_notes and shift_tasks migrations
- [ ] Add manager instructions when creating shift
- [ ] Add employee handover notes during/after shift
- [ ] Create task checklists per shift
- [ ] Track task completion
- [ ] Show handover notes to next shift
- [ ] Require acknowledgment for instructions
- [ ] Write tests

## Tests

Suggested tests for `tests/Feature/ShiftNotesHandoverTest.php`:

1. `test_admin_can_add_instructions_to_shift`
2. `test_employee_sees_instructions_on_shift`
3. `test_employee_can_acknowledge_instructions`
4. `test_employee_can_add_handover_notes`
5. `test_next_shift_sees_handover_notes`
6. `test_admin_can_create_task_checklist`
7. `test_employee_can_mark_task_complete`
8. `test_task_completion_is_tracked`
9. `test_instructions_requiring_ack_are_highlighted`
10. `test_only_shift_employee_can_add_handover`

## Dependencies

- Shift model
- User model
