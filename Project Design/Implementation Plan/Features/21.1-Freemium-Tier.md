# Feature 21.1: Freemium Tier Implementation

**Status:** Not Started
**Effort:** Medium
**Phase:** 21 - Business Model

## Overview

Implement a limited free tier to allow small businesses to try Plannrly without financial commitment. The free tier has strict limitations to encourage upgrades while still providing core value.

## Requirements

### Freemium Limits
- Maximum 1 location
- Maximum 5 active employees
- Basic scheduling only
- No time & attendance features
- No reporting features
- Plannrly branding on emails and exports

### Functional Requirements
- Free plan integrated into subscription system
- Limit checks enforced at creation points
- Upgrade prompts shown at limit boundaries
- Branding added to free tier communications
- Clear upgrade path UI
- Grace period for exceeding limits

### Upgrade Prompts
Show upgrade prompts when:
- Adding 5th employee
- Attempting to add 2nd location
- Accessing time & attendance
- Accessing reports
- Viewing schedule for 30+ days

## Files

### To Create
- `app/Services/FreemiumService.php`
- `app/Http/Middleware/CheckFreemiumLimits.php`
- `app/Notifications/FreemiumLimitReachedNotification.php`
- `resources/views/components/upgrade-prompt.blade.php`
- `resources/views/billing/upgrade.blade.php`
- `tests/Feature/FreemiumTierTest.php`

### To Modify
- `app/Models/Subscription.php` - Add free plan support
- `app/Http/Controllers/EmployeeController.php` - Add limit checks
- `app/Http/Controllers/LocationController.php` - Add limit checks
- `config/subscription.php` - Add free tier configuration

### Routes
```php
Route::get('upgrade', [BillingController::class, 'upgrade'])->name('billing.upgrade');
Route::get('upgrade/prompt/{feature}', [BillingController::class, 'upgradePrompt'])->name('billing.upgrade-prompt');
```

## Configuration

### config/subscription.php
```php
return [
    'tiers' => [
        'free' => [
            'name' => 'Free',
            'price' => 0,
            'limits' => [
                'locations' => 1,
                'employees' => 5,
            ],
            'features' => [
                'scheduling' => true,
                'time_attendance' => false,
                'reports' => false,
                'api_access' => false,
                'priority_support' => false,
            ],
            'branding' => true, // Show Plannrly branding
        ],
        // ... other tiers
    ],
];
```

## Limit Enforcement Points

| Action | Check | Prompt |
|--------|-------|--------|
| Create employee | employees < limit | Upgrade to add more team members |
| Create location | locations < limit | Upgrade for multiple locations |
| Access clock in/out | time_attendance enabled | Upgrade for time tracking |
| Access reports | reports enabled | Upgrade for analytics |
| API request | api_access enabled | Upgrade for API access |

## Email Branding

For free tier tenants, emails include:
- Plannrly logo in footer
- "Sent via Plannrly Free" tagline
- "Upgrade for branded emails" link

## Tasks

- [ ] Add 'free' plan to subscription configuration
- [ ] Create FreemiumService for limit checking
- [ ] Create CheckFreemiumLimits middleware
- [ ] Implement location limit check in LocationController
- [ ] Implement employee limit check in EmployeeController
- [ ] Disable time & attendance for free tier
- [ ] Disable reports for free tier
- [ ] Create upgrade prompt component
- [ ] Add upgrade prompts at limit points
- [ ] Add Plannrly branding to free tier emails
- [ ] Create upgrade path UI page
- [ ] Create FreemiumLimitReachedNotification
- [ ] Write comprehensive tests

## Tests

Planned tests for `tests/Feature/FreemiumTierTest.php`:

1. `test_free_tier_can_create_up_to_5_employees`
2. `test_free_tier_cannot_exceed_5_employees`
3. `test_free_tier_can_create_one_location`
4. `test_free_tier_cannot_create_second_location`
5. `test_free_tier_cannot_access_time_attendance`
6. `test_free_tier_cannot_access_reports`
7. `test_upgrade_prompt_shown_at_limit`
8. `test_free_tier_emails_include_branding`
9. `test_paid_tier_has_no_employee_limit`
10. `test_paid_tier_has_no_branding`
11. `test_upgrading_removes_limits`
12. `test_downgrading_enforces_limits`

## Dependencies

- Subscription/billing system
- Tenant model
- Email notification system
- Employee model
- Location model
