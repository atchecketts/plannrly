# Feature 10.7: Multi-Location Analytics (Enterprise)

**Status:** Not Started
**Effort:** Large
**Phase:** 10 - Premium Add-On Features

## Overview

Cross-location comparison and consolidated reporting. This enterprise feature enables organizations with multiple locations to compare performance metrics and generate consolidated reports across all their sites.

## Requirements

### Functional Requirements
- Location performance comparison dashboard
- Consolidated labor cost reporting
- Benchmark locations against each other
- Identify top/bottom performers
- Executive summary view

### Business Rules
- Feature gated by enterprise subscription
- Data aggregated across all accessible locations
- Comparisons use consistent metrics and time periods
- Executive view shows high-level KPIs only

### Prerequisites
- Phase 1.6 (Subscription & Feature Management) must be completed

## Files

### Created/Modified
- `app/Services/MultiLocationAnalyticsService.php` - Analytics service
- `app/Http/Controllers/MultiLocationAnalyticsController.php` - Controller
- `resources/views/analytics/multi-location/index.blade.php` - Dashboard
- `resources/views/analytics/multi-location/comparison.blade.php` - Comparison view
- `resources/views/components/location-comparison-chart.blade.php` - Chart component
- `tests/Feature/MultiLocationAnalyticsTest.php` - Feature tests

### Routes
```php
Route::middleware(['auth', 'feature:multi-location-analytics'])->group(function () {
    Route::get('analytics/multi-location', [MultiLocationAnalyticsController::class, 'index'])
        ->name('analytics.multi-location.index');
    Route::get('analytics/multi-location/comparison', [MultiLocationAnalyticsController::class, 'comparison'])
        ->name('analytics.multi-location.comparison');
    Route::get('analytics/multi-location/executive', [MultiLocationAnalyticsController::class, 'executive'])
        ->name('analytics.multi-location.executive');
    Route::get('analytics/multi-location/export', [MultiLocationAnalyticsController::class, 'export'])
        ->name('analytics.multi-location.export');
});
```

## Tasks

- [ ] Create MultiLocationAnalyticsService
- [ ] Create MultiLocationAnalyticsController
- [ ] Build location comparison dashboard
- [ ] Implement labor cost aggregation
- [ ] Create performance ranking
- [ ] Build executive summary view
- [ ] Add feature gate middleware (enterprise)
- [ ] Write tests

## Tests

Tests to be created in `tests/Feature/MultiLocationAnalyticsTest.php`:

1. `test_feature_requires_enterprise_subscription`
2. `test_dashboard_shows_all_locations`
3. `test_labor_cost_aggregated_correctly`
4. `test_location_comparison_accurate`
5. `test_performance_ranking_calculated`
6. `test_executive_summary_shows_kpis`
7. `test_data_filtered_by_date_range`
8. `test_export_works`

## Dependencies

- Feature 1.6: Subscription & Feature Management
- Location model
- Shift model
- ClockEvent model
- User model

## Notes

### Key Metrics for Comparison
- Total labor hours
- Labor cost per location
- Overtime hours
- Shift coverage rate
- Clock-in compliance
- Average hours per employee
- Staffing efficiency (actual vs scheduled)

### Executive Summary KPIs
- Total organization labor cost
- Total headcount
- Average hours per employee
- Overtime percentage
- Best/worst performing location

### Visualization
- Bar charts for location comparison
- Trend lines for time-based metrics
- Ranking tables
- Heat maps for performance
