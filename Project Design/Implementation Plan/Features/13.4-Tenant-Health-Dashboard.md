# Feature 13.4: Tenant Health Dashboard

**Status:** Not Started
**Effort:** Medium
**Phase:** 13 - SuperAdmin Analytics Dashboard

## Overview

Monitor tenant activity and identify at-risk accounts for SuperAdmin analytics. This provides proactive insights into tenant engagement and helps identify accounts that may need attention or are at risk of churning.

## Requirements

### Functional Requirements
- Calculate tenant health score based on multiple indicators
- Identify at-risk accounts based on activity thresholds
- Track activity metrics per tenant
- Provide health score visualization
- Allow configuration of alert thresholds

### Health Indicators
| Indicator | Healthy | At-Risk |
|-----------|---------|---------|
| Last Login | < 7 days | > 30 days |
| Shifts Created | > 10/week | 0 in 2 weeks |
| Active Users | > 50% | < 20% |
| Payment Status | Current | Past due |

### UI Components
- Overall tenant health summary
- At-risk accounts list with details
- Health score visualization (gauge or color-coded)
- Per-tenant activity metrics
- Alert threshold configuration

## Files

### To Create
- `resources/views/super-admin/analytics/tenant-health.blade.php` - Tenant health view
- `tests/Feature/SuperAdmin/TenantHealthDashboardTest.php` - Feature tests

### Routes
```php
Route::prefix('super-admin')->group(function () {
    Route::get('analytics/tenant-health', [AnalyticsController::class, 'tenantHealth'])->name('super-admin.analytics.tenant-health');
});
```

## Tasks

- [ ] Create tenant health score algorithm in SuperAdminAnalyticsService
- [ ] Create at-risk accounts list query
- [ ] Add activity metrics per tenant
- [ ] Create health score visualization
- [ ] Add alert thresholds configuration
- [ ] Write tests

## Health Score Algorithm

The health score should be calculated based on weighted factors:
- Login recency (30%)
- Feature usage / shifts created (25%)
- Active user percentage (25%)
- Payment status (20%)

Score ranges:
- 80-100: Healthy (green)
- 60-79: Warning (yellow)
- 0-59: At-risk (red)

## Tests

Suggested tests for `tests/Feature/SuperAdmin/TenantHealthDashboardTest.php`:

1. `test_super_admin_can_view_tenant_health_dashboard`
2. `test_health_score_calculation_is_accurate`
3. `test_at_risk_tenants_are_identified`
4. `test_healthy_tenants_are_identified`
5. `test_activity_metrics_are_correct`
6. `test_login_recency_affects_health_score`
7. `test_payment_status_affects_health_score`

## Dependencies

- SuperAdminAnalyticsService (from 13.1)
- Tenant model with relationships
- User model with last_login_at tracking
- Shift model
- Subscription model with payment status
