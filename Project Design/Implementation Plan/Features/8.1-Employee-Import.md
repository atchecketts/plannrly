# Feature 8.1: Employee Import

**Status:** Not Started
**Effort:** Medium
**Phase:** 8 - Data Import/Export

## Overview

Allow administrators to bulk import employees via CSV file upload. This streamlines the onboarding process when adding multiple employees at once, such as during initial system setup or when onboarding a new team.

## Requirements

### Functional Requirements
- Upload CSV file with employee data
- Download CSV template with correct columns
- Validate all rows before import
- Display validation errors with row/column information
- Queue import job for large files
- Send welcome emails to imported users
- Show import progress and results

### CSV Template Columns
| Column | Required | Description |
|--------|----------|-------------|
| first_name | Yes | Employee first name |
| last_name | Yes | Employee last name |
| email | Yes | Unique email address |
| phone | No | Phone number |
| department | No | Department name (must exist) |
| role | No | Business role name (must exist) |
| start_date | No | Employment start date (YYYY-MM-DD) |
| hourly_rate | No | Base hourly rate |

### Business Rules
- Email addresses must be unique
- Departments and roles must already exist in the system
- Failed rows should not prevent successful rows from importing
- Import results should be logged for audit purposes
- Welcome emails are optional (configurable)

## Files

### To Create
- `app/Http/Controllers/ImportController.php`
- `app/Http/Requests/Import/EmployeeImportRequest.php`
- `app/Jobs/ProcessEmployeeImport.php`
- `app/Services/EmployeeImportService.php`
- `app/Exports/EmployeeImportTemplate.php`
- `resources/views/users/import.blade.php`
- `resources/views/users/partials/import-results.blade.php`
- `storage/app/templates/employee-import-template.csv`
- `tests/Feature/EmployeeImportTest.php`

### Routes
```php
Route::get('users/import', [ImportController::class, 'showImportForm'])->name('users.import');
Route::post('users/import', [ImportController::class, 'import'])->name('users.import.process');
Route::get('users/import/template', [ImportController::class, 'downloadTemplate'])->name('users.import.template');
Route::get('users/import/status/{jobId}', [ImportController::class, 'importStatus'])->name('users.import.status');
```

## Tasks

- [ ] Create ImportController
- [ ] Create EmployeeImportRequest validation
- [ ] Create EmployeeImportService for processing logic
- [ ] Create import form with CSV upload
- [ ] Create CSV template download
- [ ] Implement ProcessEmployeeImport job (queued)
- [ ] Implement row-level validation with error collection
- [ ] Handle validation errors with clear messaging
- [ ] Add option to send welcome emails to imported users
- [ ] Show import progress for large files
- [ ] Display import results summary
- [ ] Log import activity for audit trail
- [ ] Write tests

## Import Workflow

1. Admin downloads CSV template
2. Admin fills in employee data
3. Admin uploads CSV file
4. System validates all rows
5. If validation errors, display errors and allow correction
6. If valid, queue import job
7. Process each row, creating users
8. Optionally send welcome emails
9. Display results summary (success/failure counts)

## Tests

Tests to be created in `tests/Feature/EmployeeImportTest.php`:

1. `test_admin_can_view_import_form`
2. `test_non_admin_cannot_view_import_form`
3. `test_can_download_import_template`
4. `test_can_import_valid_csv`
5. `test_import_validates_required_fields`
6. `test_import_validates_unique_email`
7. `test_import_validates_existing_department`
8. `test_import_validates_existing_role`
9. `test_import_handles_partial_success`
10. `test_import_sends_welcome_emails_when_enabled`
11. `test_import_job_is_queued_for_large_files`
12. `test_import_results_show_success_and_failure_counts`

## Dependencies

- User model and factory
- Department model
- BusinessRole model
- Mail system for welcome emails
- Queue system for background processing
