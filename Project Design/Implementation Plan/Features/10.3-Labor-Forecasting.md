# Feature 10.3: Labor Demand Forecasting (Premium)

**Status:** Not Started
**Effort:** Extra Large
**Phase:** 10 - Premium Add-On Features

## Overview

AI-powered staffing predictions based on historical data. This premium feature analyzes past scheduling patterns to predict future labor needs, helping managers optimize staffing levels.

## Requirements

### Functional Requirements
- Analyze historical scheduling patterns
- Generate daily/hourly staffing predictions
- Factor in day of week, seasonality
- Confidence scores for predictions
- Integration with AI Scheduling
- Visual forecast charts

### Business Rules
- Feature gated by premium subscription
- Requires minimum 8 weeks of historical data
- Predictions updated weekly via scheduled job
- Forecasts available for up to 4 weeks ahead

### Prerequisites
- Phase 1.6 (Subscription & Feature Management) must be completed

## Database Changes

```php
Schema::create('labor_forecasts', function (Blueprint $table) {
    $table->id();
    $table->foreignId('location_id')->constrained()->cascadeOnDelete();
    $table->foreignId('department_id')->nullable()->constrained()->cascadeOnDelete();
    $table->date('forecast_date');
    $table->tinyInteger('hour')->nullable(); // null for daily forecasts
    $table->decimal('predicted_hours', 8, 2);
    $table->integer('predicted_headcount');
    $table->decimal('confidence_score', 3, 2); // 0.00 to 1.00
    $table->json('factors')->nullable(); // contributing factors
    $table->timestamps();

    $table->unique(['location_id', 'department_id', 'forecast_date', 'hour']);
});
```

## Files

### Created/Modified
- `app/Models/LaborForecast.php` - Forecast model
- `app/Services/LaborForecastingService.php` - ML/prediction service
- `app/Jobs/GenerateLaborForecasts.php` - Scheduled forecast generation
- `app/Http/Controllers/ForecastController.php` - Forecast controller
- `resources/views/forecasting/index.blade.php` - Forecast dashboard
- `resources/views/components/forecast-chart.blade.php` - Chart component
- `tests/Feature/LaborForecastingTest.php` - Feature tests

### Routes
```php
Route::middleware(['auth', 'feature:labor-forecasting'])->group(function () {
    Route::get('forecasting', [ForecastController::class, 'index'])
        ->name('forecasting.index');
    Route::get('forecasting/{location}', [ForecastController::class, 'show'])
        ->name('forecasting.show');
    Route::post('forecasting/generate', [ForecastController::class, 'generate'])
        ->name('forecasting.generate');
});
```

## Tasks

- [ ] Create LaborForecast model
- [ ] Create LaborForecastingService with ML algorithm
- [ ] Implement historical pattern analysis
- [ ] Create seasonal adjustment factors
- [ ] Create GenerateLaborForecasts job (scheduled weekly)
- [ ] Create ForecastController
- [ ] Build forecast visualization UI
- [ ] Integrate forecasts with AI Scheduling
- [ ] Add feature gate middleware
- [ ] Write tests

## Tests

Tests to be created in `tests/Feature/LaborForecastingTest.php`:

1. `test_feature_requires_premium_subscription`
2. `test_forecasts_generated_for_location`
3. `test_forecasts_include_confidence_score`
4. `test_forecast_respects_minimum_data_requirement`
5. `test_day_of_week_pattern_detected`
6. `test_seasonal_adjustment_applied`
7. `test_forecast_job_runs_successfully`
8. `test_forecast_chart_renders`
9. `test_forecasts_integrated_with_scheduling`

## Dependencies

- Feature 1.6: Subscription & Feature Management
- Feature 7.x: AI Scheduling (for integration)
- Shift model with historical data
- Location model
- Department model

## Notes

### Forecasting Algorithm Approach
1. Collect historical shift data (8+ weeks)
2. Calculate average hours/headcount by:
   - Day of week
   - Hour of day
   - Week of month (for monthly patterns)
3. Apply trend detection (increasing/decreasing)
4. Calculate confidence based on data variance
5. Generate predictions for future dates

### Factors to Consider
- Day of week patterns
- Time of day patterns
- Holiday impacts
- Seasonal trends
- Growth/decline trends

### Chart Library
- Use Chart.js for forecast visualization
- Show predicted vs actual comparison
- Display confidence intervals
