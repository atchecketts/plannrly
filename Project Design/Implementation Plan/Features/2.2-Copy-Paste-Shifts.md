# Feature 2.2: Copy and Paste Shifts

**Status:** Complete
**Completed:** January 2026
**Effort:** Medium
**Phase:** 2 - Scheduling Features

## Overview

Allow copying shifts or entire schedule patterns. This feature enables managers to efficiently duplicate shifts or patterns across the schedule, reducing manual data entry and improving scheduling efficiency.

## Requirements

### Functional Requirements
- Copy button on shift context menu
- Clipboard state management in JavaScript
- Paste button on empty schedule cells
- Support copying single shift
- Support copying entire day's shifts
- Support copying entire week's schedule
- Keyboard shortcuts (Ctrl+C, Ctrl+V)

### Technical Requirements
- JavaScript clipboard state management
- AJAX endpoint for duplicating shifts
- Integration with existing schedule views

## Files

### Created
- `app/Http/Controllers/ShiftCopyController.php` - Handles paste endpoint with batch shift creation
- `app/Http/Requests/Shift/PasteShiftsRequest.php` - Validates paste operations with tenant isolation
- `resources/views/components/shift-context-menu.blade.php` - Context menu component
- `tests/Feature/ShiftCopyPasteTest.php` - Comprehensive feature tests (16 test cases)

### Modified
- `routes/web.php` - Added paste route
- `resources/views/schedule/index.blade.php` - Clipboard state, context menu, keyboard shortcuts
- `resources/views/schedule/day.blade.php` - Clipboard state, context menu, keyboard shortcuts

## Tasks

- [x] Add copy button to shift context menu
- [x] Implement clipboard state in JavaScript
- [x] Add paste button on empty cells
- [x] Create endpoint to duplicate shifts
- [x] Support copying single shift
- [x] Support copying entire day's shifts
- [x] Support copying entire week's schedule
- [x] Add keyboard shortcuts (Ctrl+C, Ctrl+V)
- [x] Write tests

## Implementation Details

### Backend
- `ShiftCopyController::paste()` - Creates shifts in batch from clipboard data
- Validation includes tenant scoping for all IDs (business_role_id, department_id, location_id, user_id)
- Overlap detection prevents conflicting shifts
- Role compatibility validation when assigning to specific employees
- All pasted shifts created as Draft status

### Frontend (Alpine.js)
- `clipboard` object stores type, data array, source date, and timestamp
- Session storage persistence for cross-navigation clipboard retention
- Context menu with Copy Shift, Copy Day, Paste options
- Keyboard shortcuts: Ctrl+C (copy selected), Ctrl+V (paste to hovered cell), Escape (clear)
- Visual indicators: selection ring, clipboard status in toolbar

### Test Coverage
- Admin can copy/paste single shift
- Paste to different date/user works
- Role compatibility validation
- Overlap detection prevents conflicts
- Pasted shifts created as Draft
- Copy/paste entire day works
- Copy/paste entire week works
- Employee cannot copy/paste
- DepartmentAdmin restricted to their department
- Tenant isolation enforced

## Dependencies

- Shift model
- ShiftController
- Schedule week and day views
- Alpine.js for clipboard state management
