# Feature 4.1: Additional Notifications

**Status:** Complete
**Effort:** Medium
**Phase:** 4 - Notifications

## Overview

Create additional notification types for shift changes, leave request status updates, swap requests, and shift reminders. These notifications keep employees and managers informed about important scheduling events.

## Requirements

### Functional Requirements
- Notify employees when shifts are changed or deleted
- Notify employees when leave requests are approved/rejected
- Notify employees when they receive a swap request
- Notify employees when their swap request is accepted/rejected
- Remind employees of upcoming shifts

### Notification Types
| Notification | Trigger | Recipients |
|--------------|---------|------------|
| ShiftChangedNotification | Shift edited/deleted | Assigned employee |
| LeaveRequestStatusNotification | Leave approved/rejected | Requesting employee |
| SwapRequestNotification | Swap requested | Target employee |
| SwapRequestResponseNotification | Swap accepted/rejected | Requesting employee |
| ShiftReminderNotification | Scheduled before shift | Assigned employee |

## Files

### Created
- `app/Notifications/ShiftChangedNotification.php`
- `app/Notifications/LeaveRequestStatusNotification.php`
- `app/Notifications/SwapRequestNotification.php`
- `app/Notifications/SwapRequestResponseNotification.php`
- `app/Notifications/ShiftReminderNotification.php`
- `app/Console/Commands/SendShiftRemindersCommand.php`

### Modified
- `app/Http/Controllers/LeaveRequestController.php` - Added notification on review
- `app/Http/Controllers/ShiftSwapController.php` - Added notifications on store/accept/reject/cancel/approve
- `app/Http/Controllers/ShiftController.php` - Added notifications on update/destroy

## Tasks

- [x] Create ShiftChangedNotification (when shift is edited/deleted)
- [x] Create LeaveRequestStatusNotification (approved/rejected)
- [x] Create SwapRequestNotification (when swap is requested)
- [x] Create SwapRequestResponseNotification (accepted/rejected)
- [x] Create ShiftReminderNotification (upcoming shift reminder)
- [x] Register notifications in appropriate controllers
- [x] Create SendShiftRemindersCommand for scheduled reminders
- [x] Write tests

## Notification Channels

Each notification supports:
- Email (mail channel)
- Database (for in-app notifications)

## Shift Reminder Scheduling

The shift reminder system uses `SendShiftRemindersCommand`:
```php
// Run hourly to check for shifts starting in the next hour
Schedule::command('shifts:send-reminders')->hourly();
```

Supports:
- Day-before reminders (configurable)
- Hour-before reminders (configurable)
- Tracks `reminder_sent_at` and `hour_reminder_sent_at` on shifts to prevent duplicates

## Dependencies

- Shift model
- LeaveRequest model
- ShiftSwapRequest model
- User model
- Laravel Notification system
- Laravel Scheduler (for reminders)
