# Feature 3.7: Attendance Reports

**Status:** Complete
**Completed:** January 2026
**Effort:** Large
**Phase:** 3 - Time & Attendance

## Overview

Generate attendance and time variance reports. This feature provides comprehensive reporting on employee attendance patterns, punctuality, overtime, and absences to help managers make informed decisions about staffing and identify issues.

## Requirements

### Functional Requirements
- Multiple report types (see table below)
- Date range filtering
- Department/location filtering
- Export to CSV/PDF
- Charts and visualizations

### Reports to Include
| Report | Description |
|--------|-------------|
| Punctuality Report | On-time vs late arrivals by employee/dept |
| Hours Worked Report | Scheduled vs actual hours comparison |
| Overtime Report | Overtime hours by employee/department |
| Absence Report | No-shows and missed shifts |
| Attendance Summary | Overall attendance rate metrics |

### Metrics to Calculate
- Attendance rate: (shifts worked / shifts scheduled) x 100
- Punctuality rate: (on-time arrivals / total arrivals) x 100
- Average variance: Mean difference from scheduled times
- Total overtime hours: Sum of positive variances
- Total undertime hours: Sum of negative variances

## Implementation

### Files Created
- `app/Http/Controllers/AttendanceReportController.php` - Controller with routes for all reports
- `app/Services/AttendanceReportService.php` - Service with calculation logic
- `resources/views/reports/attendance/index.blade.php` - Summary dashboard
- `resources/views/reports/attendance/punctuality.blade.php` - Punctuality report
- `resources/views/reports/attendance/hours.blade.php` - Hours worked report
- `resources/views/reports/attendance/overtime.blade.php` - Overtime report
- `resources/views/reports/attendance/absence.blade.php` - Absence report
- `resources/views/reports/attendance/employee.blade.php` - Individual employee report
- `resources/views/reports/attendance/department.blade.php` - Department report
- `resources/views/reports/attendance/_filters.blade.php` - Shared filters partial
- `tests/Feature/AttendanceReportTest.php` - Comprehensive tests

### Files Modified
- `app/Policies/UserPolicy.php` - Added viewReports method
- `routes/web.php` - Added attendance report routes

## Tasks

- [x] Create AttendanceReportService for calculations
- [x] Create AttendanceReportController
- [x] Create punctuality report view
- [x] Create hours worked report with scheduled vs actual
- [x] Create overtime analysis report
- [x] Create absence/no-show report
- [x] Create attendance summary dashboard
- [x] Add date range filtering
- [x] Add department/location filtering
- [x] Add export to CSV
- [x] Write tests

## Report Service Methods

```php
AttendanceReportService:
- getAttendanceRate($dateRange, $filters)
- getPunctualityRate($dateRange, $filters)
- getOvertimeHours($dateRange, $filters)
- getUndertimeHours($dateRange, $filters)
- getMissedShifts($dateRange, $filters)
- getEmployeeSummary($employeeId, $dateRange)
- getDepartmentSummary($departmentId, $dateRange)
- generatePunctualityReport($dateRange, $filters)
- generateHoursWorkedReport($dateRange, $filters)
- generateOvertimeReport($dateRange, $filters)
- generateAbsenceReport($dateRange, $filters)
- generateAttendanceSummary($dateRange, $filters)
- exportToCsv($reportType, $reportData)
```

## Routes

| Method | URI | Name | Description |
|--------|-----|------|-------------|
| GET | reports/attendance | reports.attendance.index | Summary dashboard |
| GET | reports/attendance/punctuality | reports.attendance.punctuality | Punctuality report |
| GET | reports/attendance/hours | reports.attendance.hours | Hours worked report |
| GET | reports/attendance/overtime | reports.attendance.overtime | Overtime report |
| GET | reports/attendance/absence | reports.attendance.absence | Absence report |
| GET | reports/attendance/employee/{user} | reports.attendance.employee | Employee detail report |
| GET | reports/attendance/department/{department} | reports.attendance.department | Department detail report |
| GET | reports/attendance/export/{type} | reports.attendance.export | Export to CSV |

## Authorization

Reports are accessible to:
- Super Admin
- Admin
- Location Admin
- Department Admin

Employees cannot access attendance reports.

## Dependencies

- TimeEntry model with variance accessors
- Shift model
- User model
- Department model
- Location model
- Feature 3.3 (Scheduled vs Actual Time Variance)
