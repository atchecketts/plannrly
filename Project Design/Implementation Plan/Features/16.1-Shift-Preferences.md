# Feature 16.1: Shift Preferences

**Status:** Not Started
**Effort:** Medium
**Phase:** 16 - Scheduling Enhancements

## Overview

Capture employee shift preferences beyond basic availability. Employees can indicate which days, times, and coworkers they prefer or want to avoid, with different preference levels.

## Requirements

### Functional Requirements
- Employees can set day/time preferences with levels (strong prefer, mild prefer, avoid)
- Employees can set coworker preferences (prefer to work with, prefer not to work with)
- Preferences are visible to managers in scheduling view
- Calculate preference satisfaction score for schedules
- Preferences are considered but not mandatory (unlike availability)

### Preference Levels
- **Strong Prefer**: Employee strongly wants this
- **Mild Prefer**: Employee prefers this if possible
- **Neutral**: No preference
- **Mild Avoid**: Employee would rather not, but can if needed
- **Strong Avoid**: Employee strongly wants to avoid this

### UI Components
- Day/time preference grid
- Coworker preference list
- Preference level selector
- Preference visibility in scheduling view
- Satisfaction score display

## Files

### To Create
- `app/Models/UserShiftPreference.php` - Time preferences model
- `app/Models/UserCoworkerPreference.php` - Coworker preferences model
- `app/Http/Controllers/ShiftPreferenceController.php` - Controller
- `database/migrations/xxxx_create_user_shift_preferences_table.php`
- `database/migrations/xxxx_create_user_coworker_preferences_table.php`
- `resources/views/settings/shift-preferences.blade.php` - Preferences form
- `tests/Feature/ShiftPreferencesTest.php` - Feature tests

### Routes
```php
Route::get('settings/shift-preferences', [ShiftPreferenceController::class, 'index'])->name('settings.shift-preferences');
Route::post('settings/shift-preferences', [ShiftPreferenceController::class, 'store'])->name('settings.shift-preferences.store');
Route::get('api/users/{user}/preferences', [ShiftPreferenceController::class, 'show'])->name('api.users.preferences');
```

## Database Schema

### user_shift_preferences
```php
Schema::create('user_shift_preferences', function (Blueprint $table) {
    $table->id();
    $table->foreignId('user_id')->constrained()->cascadeOnDelete();
    $table->tinyInteger('day_of_week'); // 0-6 (Sunday-Saturday)
    $table->time('start_time')->nullable(); // null = entire day
    $table->time('end_time')->nullable();
    $table->enum('level', ['strong_prefer', 'mild_prefer', 'neutral', 'mild_avoid', 'strong_avoid']);
    $table->text('note')->nullable();
    $table->timestamps();

    $table->unique(['user_id', 'day_of_week', 'start_time', 'end_time']);
});
```

### user_coworker_preferences
```php
Schema::create('user_coworker_preferences', function (Blueprint $table) {
    $table->id();
    $table->foreignId('user_id')->constrained()->cascadeOnDelete();
    $table->foreignId('coworker_id')->constrained('users')->cascadeOnDelete();
    $table->enum('level', ['prefer', 'avoid']);
    $table->text('note')->nullable();
    $table->timestamps();

    $table->unique(['user_id', 'coworker_id']);
});
```

## Preference Satisfaction Score

Calculate a score (0-100) based on how well a schedule matches preferences:
- Strong prefer matched: +10
- Mild prefer matched: +5
- Mild avoid scheduled: -5
- Strong avoid scheduled: -10
- Coworker preferences: Similar weighting

## Tasks

- [ ] Create preference migrations
- [ ] Create preference management UI
- [ ] Add day/time preferences with levels (strong, mild, avoid)
- [ ] Add coworker preferences
- [ ] Show preferences in scheduling view
- [ ] Calculate preference satisfaction score
- [ ] Write tests

## Tests

Suggested tests for `tests/Feature/ShiftPreferencesTest.php`:

1. `test_employee_can_view_preferences_page`
2. `test_employee_can_set_day_preference`
3. `test_employee_can_set_time_range_preference`
4. `test_employee_can_set_coworker_preference`
5. `test_preference_levels_are_saved_correctly`
6. `test_manager_can_view_employee_preferences`
7. `test_preference_satisfaction_score_calculation`
8. `test_strong_avoid_affects_score_more_than_mild`
9. `test_coworker_preferences_affect_score`

## Dependencies

- User model
- Scheduling views and services
