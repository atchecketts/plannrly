# Feature 5.2: Employee Statistics

**Status:** Not Started
**Effort:** Medium
**Phase:** 5 - Reports & Analytics

## Overview

Display meaningful statistics on employee profile pages including hours worked, leave balance, attendance rate, and shift history. This provides employees with visibility into their own metrics.

## Requirements

### Functional Requirements
- Show hours worked this week, month, and year on user profile
- Show current leave balance by leave type
- Show attendance rate (shifts worked vs scheduled)
- Display shift history with pagination
- Both employees (own profile) and admins (any profile) can view statistics

### Business Rules
- Employees can only view their own statistics
- Admins can view statistics for any employee
- Hours calculations should account for shift start/end times
- Attendance rate should only count shifts in the past
- Leave balance should reflect approved leave taken

## Files

### To Create/Modify
- `app/Services/EmployeeStatisticsService.php`
- `resources/views/users/show.blade.php` (modify)
- `resources/views/users/partials/statistics.blade.php`
- `resources/views/users/partials/shift-history.blade.php`
- `tests/Feature/EmployeeStatisticsTest.php`

### Routes
```php
Route::get('users/{user}/statistics', [UserController::class, 'statistics'])->name('users.statistics');
Route::get('users/{user}/shift-history', [UserController::class, 'shiftHistory'])->name('users.shift-history');
```

## Tasks

- [ ] Create EmployeeStatisticsService for calculating metrics
- [ ] Add hours worked this week/month/year to user show page
- [ ] Add leave balance display by leave type
- [ ] Add attendance rate calculation (shifts worked vs scheduled)
- [ ] Show shift history on user profile with pagination
- [ ] Add visual progress indicators for metrics
- [ ] Ensure proper authorization (employee sees own, admin sees all)
- [ ] Write tests

## Tests

Tests to be created in `tests/Feature/EmployeeStatisticsTest.php`:

1. `test_employee_can_view_own_statistics`
2. `test_employee_cannot_view_other_statistics`
3. `test_admin_can_view_any_employee_statistics`
4. `test_hours_worked_calculates_correctly_for_week`
5. `test_hours_worked_calculates_correctly_for_month`
6. `test_hours_worked_calculates_correctly_for_year`
7. `test_leave_balance_shows_correct_remaining`
8. `test_attendance_rate_calculates_correctly`
9. `test_shift_history_shows_past_shifts`
10. `test_shift_history_is_paginated`

## Dependencies

- User model
- Shift model with employee assignment
- LeaveRequest model
- LeaveBalance model
- UserEmploymentDetails model
