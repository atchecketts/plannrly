# Feature 6.1: Employee Profile (Self-Service)

**Status:** Completed
**Effort:** Medium
**Phase:** 6 - Employee Management

## Overview

Allow employees to view and update their own personal information, including contact details, profile photo, and password. This self-service feature reduces administrative burden and empowers employees to manage their own data.

## Requirements

### Functional Requirements
- Employees can view their personal profile information
- Employees can update contact details (phone, email, address)
- Employees can upload/change profile photo (avatar)
- Employees can change password with current password verification
- Employees can view employment details (read-only: start date, role, pay info)
- Employees can view their current availability settings

### Business Rules
- Email changes may require re-verification
- Password changes require current password for security
- Avatar uploads should be processed and resized
- Employment details are read-only for employees
- Profile link should be accessible from user dropdown menu

## Files

### To Create
- `app/Http/Controllers/ProfileController.php`
- `app/Http/Requests/Profile/UpdateProfileRequest.php`
- `app/Http/Requests/Profile/ChangePasswordRequest.php`
- `resources/views/profile/index.blade.php`
- `resources/views/profile/edit.blade.php`
- `resources/views/profile/change-password.blade.php`
- `tests/Feature/ProfileTest.php`

### Routes
```php
Route::get('profile', [ProfileController::class, 'index'])->name('profile.index');
Route::get('profile/edit', [ProfileController::class, 'edit'])->name('profile.edit');
Route::put('profile', [ProfileController::class, 'update'])->name('profile.update');
Route::get('profile/password', [ProfileController::class, 'editPassword'])->name('profile.password');
Route::put('profile/password', [ProfileController::class, 'updatePassword'])->name('profile.password.update');
Route::post('profile/avatar', [ProfileController::class, 'updateAvatar'])->name('profile.avatar.update');
Route::delete('profile/avatar', [ProfileController::class, 'deleteAvatar'])->name('profile.avatar.delete');
```

## Tasks

- [ ] Create ProfileController with index/edit/update actions
- [ ] Create UpdateProfileRequest with validation rules
- [ ] Create ChangePasswordRequest with validation rules
- [ ] Create profile index view (overview of all info)
- [ ] Create profile edit view for contact information
- [ ] Implement avatar upload with image processing/resizing
- [ ] Create password change form with validation
- [ ] Display read-only employment details section
- [ ] Display current availability settings
- [ ] Add profile link to user dropdown menu
- [ ] Write tests

## Tests

Tests to be created in `tests/Feature/ProfileTest.php`:

1. `test_user_can_view_profile`
2. `test_user_can_view_profile_edit_form`
3. `test_user_can_update_contact_details`
4. `test_user_cannot_update_employment_details`
5. `test_user_can_view_password_change_form`
6. `test_user_can_change_password_with_correct_current_password`
7. `test_user_cannot_change_password_with_incorrect_current_password`
8. `test_user_can_upload_avatar`
9. `test_user_can_delete_avatar`
10. `test_avatar_is_resized_on_upload`
11. `test_profile_shows_employment_details_readonly`
12. `test_profile_shows_availability_settings`

## Dependencies

- User model
- UserEmploymentDetails model
- UserAvailability model (if implemented)
- Image processing library (e.g., Intervention Image)
