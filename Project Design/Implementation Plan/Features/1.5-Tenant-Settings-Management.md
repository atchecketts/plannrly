# Feature 1.5: Tenant Settings Management

**Status:** Complete
**Effort:** Medium
**Phase:** 1 - Core Features
**Completed:** January 2026

## Overview

Allow business admins to configure organization-wide settings including scheduling preferences, display formats, feature toggles, and leave management policies.

## Requirements

### Functional Requirements
- Admins can view and update organization settings
- Settings are automatically created when a tenant is created (via TenantObserver)
- All settings have sensible defaults
- Changes take effect immediately

### Settings Categories

#### Scheduling Options
- Week starts on (Sunday-Saturday)
- Timezone selection
- Day start/end times
- Missed shift grace period (minutes)

#### Display Formats
- Date format (multiple options)
- Time format (12h/24h)

#### Feature Toggles
- Enable clock in/out
- Require shift acknowledgement
- Notify on schedule publish

#### Leave Management
- Leave carryover mode (none, partial, full)

#### Organization Preferences
- Default currency
- Brand/primary color

## Files

### Created
- `app/Http/Controllers/TenantSettingsController.php`
- `app/Http/Requests/TenantSettings/UpdateTenantSettingsRequest.php`
- `resources/views/settings/edit.blade.php`
- `tests/Feature/TenantSettingsManagementTest.php`
- `database/migrations/2026_01_27_151031_add_settings_columns_to_tenant_settings_table.php`

### Modified
- `app/Models/TenantSettings.php` - Added new fillable fields
- `routes/web.php` - Added settings routes

### Routes
```php
Route::get('settings', [TenantSettingsController::class, 'edit'])->name('settings.edit');
Route::put('settings', [TenantSettingsController::class, 'update'])->name('settings.update');
```

## Tasks

- [x] Create migration for new settings columns
- [x] Update TenantSettings model with new fields
- [x] Create TenantSettingsController with edit/update
- [x] Create UpdateTenantSettingsRequest with validation
- [x] Create settings edit view with all sections
- [x] Add routes to web.php
- [x] Add navigation link to sidebar
- [x] Write comprehensive tests (10 tests)

## Settings Schema

| Setting | Type | Default | Description |
|---------|------|---------|-------------|
| week_starts_on | integer | 1 (Monday) | 0=Sunday, 6=Saturday |
| timezone | string | Europe/London | PHP timezone identifier |
| day_starts_at | time | 06:00 | When the work day begins |
| day_ends_at | time | 22:00 | When the work day ends |
| date_format | string | d/m/Y | PHP date format |
| time_format | string | H:i | PHP time format |
| missed_grace_minutes | integer | 15 | Grace period before shift marked missed |
| enable_clock_in_out | boolean | false | Allow clock in/out |
| enable_shift_acknowledgement | boolean | false | Require shift acknowledgement |
| notify_on_publish | boolean | true | Notify on schedule publish |
| leave_carryover_mode | string | none | none, partial, full |
| default_currency | string | GBP | 3-letter currency code |
| primary_color | string | #6366f1 | Hex color code |

## Tests

All tests located in `tests/Feature/TenantSettingsManagementTest.php`:

1. `test_admin_can_view_settings_page`
2. `test_employee_cannot_view_settings_page`
3. `test_settings_are_created_with_tenant`
4. `test_admin_can_update_scheduling_settings`
5. `test_admin_can_update_feature_toggles`
6. `test_employee_cannot_update_settings`
7. `test_settings_require_valid_timezone`
8. `test_settings_require_valid_carryover_mode`
9. `test_settings_require_valid_color`
10. `test_different_tenants_have_separate_settings`

## Dependencies

- TenantSettings model
- Tenant model
- TenantObserver (creates settings on tenant creation)
- User role system (isAdmin, isSuperAdmin)
