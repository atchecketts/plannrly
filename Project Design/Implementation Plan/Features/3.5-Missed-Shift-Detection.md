# Feature 3.5: Missed Shift Detection

**Status:** Pending
**Effort:** Medium
**Phase:** 3 - Time & Attendance

## Overview

Automatically detect and flag missed shifts. This feature runs on a schedule to identify shifts where employees did not clock in, creating a time entry with a missed status and notifying managers of the situation.

## Requirements

### Functional Requirements
- Automatic detection via scheduler (every 15 minutes)
- Find published shifts that started past the grace period
- Check if time entry exists for that shift
- If no entry, create one with status='missed'
- Notify manager of missed shift
- Missed shift indicator on dashboards

### Detection Logic
```
1. Run every 15 minutes via scheduler
2. Find published shifts where:
   - start_time < (now - grace_period)
   - No time_entry exists for the shift
3. For each missed shift:
   - Create time_entry with status='missed'
   - Send MissedShiftNotification to manager
```

## Files

### To Create
- `app/Console/Commands/DetectMissedShiftsCommand.php`
- `app/Notifications/MissedShiftNotification.php`

### To Modify
- Console kernel (register command in scheduler)
- Dashboard views (add missed shift indicator)

## Tasks

- [ ] Create DetectMissedShiftsCommand
- [ ] Implement missed shift detection logic
- [ ] Create MissedShiftNotification
- [ ] Register command in scheduler (every 15 min)
- [ ] Add missed shift indicator to dashboards
- [ ] Write tests

## Command Details

```php
// Command signature
php artisan attendance:detect-missed-shifts

// Scheduler registration (in routes/console.php or bootstrap/app.php)
Schedule::command('attendance:detect-missed-shifts')->everyFifteenMinutes();
```

## Dependencies

- Shift model
- TimeEntry model
- User model (for manager notification)
- TenantSettings (for grace period)
- Laravel Scheduler
- Notification system
