# Feature 3.2: Clock Widget Component

**Status:** Complete
**Effort:** Medium
**Phase:** 3 - Time & Attendance
**Completed:** January 2026

## Overview

Enhanced clock-in/out widget for employee dashboard. This widget provides a convenient, always-visible interface for employees to manage their time clock actions including clocking in/out and managing breaks with AJAX-powered interactions, GPS capture, and confirmation dialogs.

## Requirements

### Functional Requirements
- Show current clock status (clocked in/out/on break) ✅
- Display current shift information if applicable ✅
- Show elapsed time since clock-in ✅
- One-click clock in/out buttons ✅
- Break start/end buttons ✅
- Show scheduled vs current time ✅
- Real-time clock display ✅
- Confirmation dialogs for clock out ✅
- Success/error message display ✅
- GPS location capture when required ✅

### Technical Requirements
- Alpine.js for real-time updates and interactivity ✅
- AJAX for clock actions (no page refresh) ✅
- Integration with employee dashboard ✅

## Implementation Details

### Files Modified
- `app/Http/Controllers/TimeEntryController.php` - Added JSON response support for AJAX requests
- `resources/views/components/clock-widget.blade.php` - Enhanced with AJAX, GPS, confirmations

### Files Created
- `tests/Feature/ClockWidgetAjaxTest.php` - 7 tests for AJAX functionality

### Controller Changes
The following methods now support both traditional form submission and AJAX requests:
- `clockIn()` - Returns JSON when `Accept: application/json` header is present
- `clockOut()` - Returns JSON when `Accept: application/json` header is present
- `startBreak()` - Returns JSON when `Accept: application/json` header is present
- `endBreak()` - Returns JSON when `Accept: application/json` header is present

### Widget Features

| Feature | Description |
|---------|-------------|
| AJAX Actions | All clock actions use fetch() API without page refresh |
| Live Timer | Updates every second showing elapsed work time |
| Break Timer | Shows break duration when on break |
| GPS Capture | Requests geolocation when require_gps_clock_in is enabled |
| GPS Status | Shows acquiring/acquired/error status |
| Confirmation Modal | Confirms before clock out |
| Inline Messages | Success/error messages displayed inline |
| Scheduled Time | Shows shift's scheduled start/end times |
| Current Time | Real-time clock in header |
| Loading States | Spinner and disabled buttons during actions |

## Widget States

| State | Display |
|-------|---------|
| Not Clocked In | Clock In button, scheduled shift info, GPS status if required |
| Clocked In | Elapsed timer, Clock Out button, Start Break button, scheduled times |
| On Break | Break timer, End Break button, elapsed total timer |
| No Shift Today | Message indicating no scheduled shift |

## Tasks

- [x] Create clock widget Blade component
- [x] Add Alpine.js interactivity for real-time updates
- [x] Handle clock-in via AJAX
- [x] Handle clock-out via AJAX
- [x] Handle break start/end via AJAX
- [x] Show confirmation dialogs
- [x] Display success/error messages
- [x] Add GPS location capture
- [x] Show scheduled vs current time
- [x] Write tests (7 AJAX tests)

## Test Coverage

### ClockWidgetAjaxTest.php (7 tests)
- Clock in returns JSON for AJAX request
- Clock in returns JSON error when already clocked in
- Clock in returns JSON error when feature disabled
- Clock out returns JSON for AJAX request
- Start break returns JSON for AJAX request
- End break returns JSON for AJAX request
- Clock in with GPS returns JSON

## Dependencies

- TimeEntryController (Phase 3.1)
- TimeEntry model
- Shift model
- TenantSettings model (require_gps_clock_in)
- Alpine.js
- Employee dashboard
