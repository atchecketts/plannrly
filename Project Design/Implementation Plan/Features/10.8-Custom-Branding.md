# Feature 10.8: Custom Branding / White Label (Enterprise)

**Status:** Not Started
**Effort:** Medium
**Phase:** 10 - Premium Add-On Features

## Overview

Customize appearance with company branding. This enterprise feature allows organizations to customize the application's appearance with their own colors, logo, and branding elements.

## Requirements

### Functional Requirements
- Custom primary/secondary colors
- Custom logo upload
- Custom favicon
- Custom login page background
- Hide "Powered by Plannrly" branding
- Custom CSS overrides (advanced)

### Business Rules
- Feature gated by enterprise subscription
- Branding applies to all users in tenant
- Custom CSS limited to safe properties
- Logo and favicon must meet size requirements

### Prerequisites
- Phase 1.6 (Subscription & Feature Management) must be completed

## Database Changes

```php
Schema::create('tenant_branding', function (Blueprint $table) {
    $table->id();
    $table->foreignId('tenant_id')->constrained()->cascadeOnDelete();
    $table->string('primary_color')->nullable();
    $table->string('secondary_color')->nullable();
    $table->string('accent_color')->nullable();
    $table->string('logo_path')->nullable();
    $table->string('favicon_path')->nullable();
    $table->string('login_background_path')->nullable();
    $table->boolean('hide_powered_by')->default(false);
    $table->text('custom_css')->nullable();
    $table->timestamps();
});
```

## Files

### Created/Modified
- `app/Models/TenantBranding.php` - Branding model
- `app/Services/BrandingService.php` - Branding service
- `app/Http/Controllers/BrandingController.php` - Branding controller
- `app/Http/Middleware/ApplyBranding.php` - Middleware to apply branding
- `resources/views/branding/index.blade.php` - Branding settings UI
- `tests/Feature/BrandingTest.php` - Feature tests

### Routes
```php
Route::middleware(['auth', 'feature:custom-branding'])->group(function () {
    Route::get('settings/branding', [BrandingController::class, 'index'])
        ->name('settings.branding');
    Route::put('settings/branding', [BrandingController::class, 'update'])
        ->name('settings.branding.update');
    Route::delete('settings/branding/logo', [BrandingController::class, 'deleteLogo'])
        ->name('settings.branding.delete-logo');
    Route::delete('settings/branding/favicon', [BrandingController::class, 'deleteFavicon'])
        ->name('settings.branding.delete-favicon');
});
```

## Tasks

- [ ] Create TenantBranding model
- [ ] Create BrandingService
- [ ] Create BrandingController
- [ ] Create ApplyBranding middleware
- [ ] Build branding customization UI
- [ ] Implement logo/favicon upload
- [ ] Apply branding to all views dynamically
- [ ] Add feature gate middleware (enterprise)
- [ ] Write tests

## Tests

Tests to be created in `tests/Feature/BrandingTest.php`:

1. `test_feature_requires_enterprise_subscription`
2. `test_admin_can_update_colors`
3. `test_admin_can_upload_logo`
4. `test_admin_can_upload_favicon`
5. `test_branding_applied_to_views`
6. `test_powered_by_can_be_hidden`
7. `test_custom_css_applied`
8. `test_invalid_css_rejected`
9. `test_branding_middleware_works`

## Dependencies

- Feature 1.6: Subscription & Feature Management
- Tenant model
- File storage (S3 or local)
- App layouts

## Notes

### Branding Service
```php
class BrandingService
{
    public function getBranding(?Tenant $tenant): ?TenantBranding
    {
        return $tenant?->branding;
    }

    public function getCssVariables(TenantBranding $branding): string
    {
        return <<<CSS
        :root {
            --color-primary: {$branding->primary_color};
            --color-secondary: {$branding->secondary_color};
            --color-accent: {$branding->accent_color};
        }
        CSS;
    }
}
```

### Middleware Implementation
```php
class ApplyBranding
{
    public function handle(Request $request, Closure $next)
    {
        $tenant = $request->user()?->tenant;
        $branding = app(BrandingService::class)->getBranding($tenant);

        view()->share('branding', $branding);

        return $next($request);
    }
}
```

### Logo Requirements
- Recommended: 200x50px or similar ratio
- Max file size: 2MB
- Formats: PNG, SVG, JPG

### Favicon Requirements
- Size: 32x32px or 64x64px
- Formats: ICO, PNG
