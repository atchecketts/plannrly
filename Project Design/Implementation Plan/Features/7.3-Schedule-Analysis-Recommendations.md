# Feature 7.3: Schedule Analysis & Recommendations

**Status:** Not Started
**Effort:** Medium
**Phase:** 7 - AI Scheduling (Premium Add-On)

## Overview

Analyze existing schedules and provide actionable improvement suggestions. This feature helps managers identify potential issues before they become problems, such as understaffing, overtime risks, and availability conflicts.

> **Prerequisite:** Feature 7.1 (AI Scheduling Service Core) must be completed first.

## Requirements

### Functional Requirements
- Identify understaffed periods based on staffing requirements
- Flag employees at risk of exceeding overtime thresholds
- Highlight availability conflicts with assigned shifts
- Show target hours progress per employee
- Suggest specific schedule improvements
- Calculate and display schedule quality score

### Analysis Metrics
| Metric | Description |
|--------|-------------|
| Coverage Score | Percentage of required positions filled |
| Overtime Risk | Employees approaching/exceeding max hours |
| Availability Conflicts | Shifts assigned outside availability |
| Target Hours Variance | Difference from target hours per employee |
| Fair Distribution Score | How evenly hours are distributed |
| Overall Quality Score | Weighted combination of all metrics |

### Business Rules
- Analysis runs on-demand or when viewing schedule
- Recommendations are actionable with one-click fixes
- Historical analysis available for completed schedules
- Metrics should be comparable across time periods

## Files

### To Create
- `app/Services/Scheduling/ScheduleAnalyzer.php`
- `app/Services/Scheduling/RecommendationEngine.php`
- `app/Http/Controllers/ScheduleAnalysisController.php`
- `resources/views/components/schedule-analysis-panel.blade.php`
- `resources/views/components/schedule-quality-score.blade.php`
- `resources/views/components/target-hours-dashboard.blade.php`
- `resources/views/components/recommendations-list.blade.php`
- `tests/Feature/ScheduleAnalysisTest.php`

### Routes
```php
Route::middleware(['auth', 'feature:ai_scheduling'])->group(function () {
    Route::get('schedule/{schedule}/analysis', [ScheduleAnalysisController::class, 'show'])->name('schedule.analysis');
    Route::get('schedule/{schedule}/recommendations', [ScheduleAnalysisController::class, 'recommendations'])->name('schedule.recommendations');
    Route::post('schedule/recommendations/{recommendation}/apply', [ScheduleAnalysisController::class, 'applyRecommendation'])->name('schedule.recommendations.apply');
});
```

## Tasks

- [ ] Create ScheduleAnalyzer service class
- [ ] Implement schedule gap analysis (understaffed periods)
- [ ] Create overtime prediction algorithm
- [ ] Build availability conflict detection
- [ ] Build target hours tracking per employee
- [ ] Create schedule quality score calculation
- [ ] Create RecommendationEngine service class
- [ ] Implement recommendation generation logic
- [ ] Create schedule analysis panel component
- [ ] Create schedule quality score display component
- [ ] Create target hours dashboard component
- [ ] Create recommendations list component with apply buttons
- [ ] Add recommendations panel to schedule view
- [ ] Write tests

## Analysis Components

### Schedule Analysis Panel
- Overall quality score (0-100) with visual indicator
- Breakdown of individual metrics
- List of identified issues with severity
- Quick actions for common fixes

### Target Hours Dashboard
- Table of employees with:
  - Current scheduled hours
  - Target hours
  - Variance (+/-)
  - Visual progress bar
- Highlight under/over scheduled employees

### Recommendations List
- Prioritized list of suggested improvements
- Each recommendation includes:
  - Issue description
  - Suggested action
  - Impact assessment
  - One-click apply button

## Tests

Tests to be created in `tests/Feature/ScheduleAnalysisTest.php`:

1. `test_can_view_schedule_analysis`
2. `test_analysis_identifies_understaffed_periods`
3. `test_analysis_flags_overtime_risks`
4. `test_analysis_detects_availability_conflicts`
5. `test_target_hours_progress_calculated_correctly`
6. `test_schedule_quality_score_calculated_correctly`
7. `test_recommendations_generated_for_issues`
8. `test_can_apply_recommendation`
9. `test_feature_requires_ai_scheduling_addon`
10. `test_analysis_panel_displays_on_schedule_view`

## Dependencies

- AISchedulingService (Feature 7.1)
- ScheduleAnalysis class (Feature 7.1)
- UserAvailability model (Feature 6.3)
- UserEmploymentDetails model (Feature 6.2)
- Shift model
- Schedule model
- Subscription/Feature Management (Phase 1.6)
