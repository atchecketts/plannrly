# Feature 9.4: Mobile API Endpoints

**Status:** Not Started
**Effort:** Medium
**Phase:** 9 - Mobile Interface & Accessibility

## Overview

Optimized API endpoints for mobile data consumption. These endpoints return lightweight payloads specifically designed for mobile bandwidth and processing constraints.

## Requirements

### Functional Requirements
- Today's schedule endpoint with current/next shift
- Week schedule endpoint with optimized payload
- Mobile clock endpoint with offline sync support
- Initial sync endpoint for offline data
- Batch sync endpoint for queued offline actions
- Unread notifications count endpoint

### Technical Requirements
- Response payloads optimized for mobile
- Appropriate caching headers
- Support for conditional requests (ETags)
- Compressed responses

## Files

### Created/Modified
- `app/Http/Controllers/Api/MobileScheduleController.php` - Schedule endpoints
- `app/Http/Controllers/Api/MobileClockController.php` - Clock endpoints with offline sync
- `app/Http/Controllers/Api/MobileNotificationController.php` - Notification endpoints
- `app/Http/Resources/MobileShiftResource.php` - Lightweight shift resource

### Routes
```php
Route::prefix('api/mobile')->middleware('auth:sanctum')->group(function () {
    // Schedule
    Route::get('schedule/today', [MobileScheduleController::class, 'today']);
    Route::get('schedule/week', [MobileScheduleController::class, 'week']);

    // Clock
    Route::post('clock/in', [MobileClockController::class, 'clockIn']);
    Route::post('clock/out', [MobileClockController::class, 'clockOut']);
    Route::post('clock/sync', [MobileClockController::class, 'sync']);

    // Notifications
    Route::get('notifications/unread-count', [MobileNotificationController::class, 'unreadCount']);

    // Initial sync
    Route::get('sync/initial', [MobileSyncController::class, 'initial']);
    Route::post('sync/batch', [MobileSyncController::class, 'batch']);
});
```

## Tasks

- [ ] Create MobileScheduleController with today/week endpoints
- [ ] Create MobileClockController with offline sync support
- [ ] Create lightweight MobileShiftResource
- [ ] Add initial sync endpoint for offline data
- [ ] Implement batch sync endpoint for offline actions
- [ ] Add unread notifications count endpoint
- [ ] Optimize response payloads for mobile
- [ ] Add response caching headers
- [ ] Write API tests

## Tests

Tests to be created in `tests/Feature/MobileApiTest.php`:

1. `test_today_schedule_returns_current_shift`
2. `test_today_schedule_returns_next_shift`
3. `test_week_schedule_returns_optimized_payload`
4. `test_mobile_clock_in_works`
5. `test_mobile_clock_out_works`
6. `test_clock_sync_processes_offline_events`
7. `test_unread_count_returns_correct_number`
8. `test_initial_sync_returns_required_data`
9. `test_batch_sync_processes_multiple_actions`
10. `test_responses_include_cache_headers`

## Dependencies

- Feature 9.2: Offline Data Storage
- Shift model
- ClockEvent model
- User model with authentication

## Notes

- Use API Resources for consistent response format
- Include ETag headers for cache validation
- Consider field selection via query parameters
- Mobile endpoints should return minimal data
- Batch sync should be idempotent
