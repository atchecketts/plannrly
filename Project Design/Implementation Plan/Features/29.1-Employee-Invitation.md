# Feature 29.1: Employee Invitation & Onboarding

**Status:** Not Started
**Effort:** Large
**Phase:** 29 - Employee Lifecycle & Bulk Operations

## Overview

Complete employee invitation and onboarding workflow. Enables admins to invite employees via email, track invitation status, and guide new employees through a configurable onboarding process.

## Requirements

### Functional Requirements

#### Invitation System
- Send email invitations to new employees
- Include role and department in invitation
- Track invitation status (pending, accepted, expired)
- Resend or cancel invitations
- Bulk import employees from CSV

#### Invitation Flow
1. Admin creates invitation with employee details
2. System sends email with secure invitation link
3. Employee clicks link and creates account
4. Employee assigned to tenant with specified role
5. Onboarding process begins

#### Onboarding Checklist
- Configurable onboarding steps per tenant
- Default steps (profile setup, read policies, etc.)
- Track completion progress
- Automated reminders for incomplete items
- Manager notification on completion

#### Onboarding Step Types
- Profile completion (fill in required fields)
- Document acknowledgment (read and accept)
- Document upload (provide required documents)
- Training completion (external links)
- Custom tasks

### Authorization
- Admins can send invitations
- Admins can configure onboarding steps
- New employees complete their own onboarding

## Database Changes

### Tables to Create

**employee_invitations**
| Column | Type | Description |
|--------|------|-------------|
| id | bigint | Primary key |
| tenant_id | bigint | Foreign key to tenants |
| email | string | Invitee email address |
| name | string | Invitee name |
| token | string | Secure invitation token |
| business_role_id | bigint | Assigned role |
| department_id | bigint | Assigned department (nullable) |
| invited_by | bigint | Admin who sent invitation |
| status | string | pending/accepted/expired/cancelled |
| expires_at | timestamp | Invitation expiry |
| accepted_at | timestamp | When accepted |
| created_at | timestamp | |
| updated_at | timestamp | |

**onboarding_configurations**
| Column | Type | Description |
|--------|------|-------------|
| id | bigint | Primary key |
| tenant_id | bigint | Foreign key to tenants |
| step_order | integer | Order of steps |
| type | string | profile/document/upload/training/custom |
| title | string | Step title |
| description | text | Instructions |
| config | json | Type-specific configuration |
| is_required | boolean | Must complete to finish |
| is_active | boolean | Currently in use |
| created_at | timestamp | |
| updated_at | timestamp | |

**onboarding_checklists**
| Column | Type | Description |
|--------|------|-------------|
| id | bigint | Primary key |
| user_id | bigint | New employee |
| configuration_id | bigint | Onboarding step config |
| status | string | pending/completed/skipped |
| completed_at | timestamp | When completed |
| data | json | Submitted data for step |
| created_at | timestamp | |
| updated_at | timestamp | |

## Files

### To Create
- `app/Models/EmployeeInvitation.php`
- `app/Models/OnboardingConfiguration.php`
- `app/Models/OnboardingChecklist.php`
- `app/Enums/InvitationStatus.php`
- `app/Enums/OnboardingStepType.php`
- `app/Enums/OnboardingStepStatus.php`
- `app/Services/InvitationService.php`
- `app/Services/OnboardingService.php`
- `app/Http/Controllers/InvitationController.php`
- `app/Http/Controllers/OnboardingController.php`
- `app/Http/Controllers/OnboardingConfigurationController.php`
- `app/Http/Requests/Invitation/StoreInvitationRequest.php`
- `app/Http/Requests/Invitation/BulkImportRequest.php`
- `app/Mail/EmployeeInvitationMail.php`
- `app/Imports/EmployeeInvitationImport.php`
- `resources/views/invitations/index.blade.php`
- `resources/views/invitations/create.blade.php`
- `resources/views/invitations/accept.blade.php`
- `resources/views/invitations/bulk-import.blade.php`
- `resources/views/onboarding/progress.blade.php`
- `resources/views/onboarding/step.blade.php`
- `resources/views/settings/onboarding/index.blade.php`
- `resources/views/settings/onboarding/create-step.blade.php`
- `resources/views/emails/employee-invitation.blade.php`
- `database/migrations/xxxx_create_employee_invitations_table.php`
- `database/migrations/xxxx_create_onboarding_configurations_table.php`
- `database/migrations/xxxx_create_onboarding_checklists_table.php`
- `tests/Feature/InvitationTest.php`
- `tests/Feature/OnboardingTest.php`

### Routes
```php
// Invitation routes
Route::resource('invitations', InvitationController::class)->except(['show', 'edit', 'update']);
Route::post('invitations/{invitation}/resend', [InvitationController::class, 'resend'])->name('invitations.resend');
Route::post('invitations/{invitation}/cancel', [InvitationController::class, 'cancel'])->name('invitations.cancel');
Route::get('invitations/bulk-import', [InvitationController::class, 'showBulkImport'])->name('invitations.bulk-import.show');
Route::post('invitations/bulk-import', [InvitationController::class, 'bulkImport'])->name('invitations.bulk-import');

// Invitation acceptance (public route)
Route::get('join/{token}', [InvitationController::class, 'accept'])->name('invitations.accept');
Route::post('join/{token}', [InvitationController::class, 'processAcceptance'])->name('invitations.accept.store');

// Onboarding routes
Route::get('onboarding', [OnboardingController::class, 'index'])->name('onboarding.index');
Route::get('onboarding/{step}', [OnboardingController::class, 'show'])->name('onboarding.show');
Route::post('onboarding/{step}', [OnboardingController::class, 'complete'])->name('onboarding.complete');

// Onboarding configuration
Route::resource('settings/onboarding', OnboardingConfigurationController::class)->except(['show']);
```

## Tasks

- [ ] Create database migrations for invitation and onboarding tables
- [ ] Create EmployeeInvitation model with token generation
- [ ] Create OnboardingConfiguration model
- [ ] Create OnboardingChecklist model
- [ ] Create InvitationStatus enum (Pending, Accepted, Expired, Cancelled)
- [ ] Create OnboardingStepType enum (Profile, Document, Upload, Training, Custom)
- [ ] Create OnboardingStepStatus enum (Pending, Completed, Skipped)
- [ ] Create InvitationService for invitation management
- [ ] Create OnboardingService for onboarding logic
- [ ] Build invitation sending workflow
- [ ] Create EmployeeInvitationMail
- [ ] Implement invitation acceptance and user creation
- [ ] Create bulk import from CSV
- [ ] Build onboarding checklist system
- [ ] Create configurable onboarding steps UI
- [ ] Implement onboarding progress tracking
- [ ] Add resend and cancel invitation actions
- [ ] Create onboarding configuration interface
- [ ] Write comprehensive tests

## Invitation Enums

```php
enum InvitationStatus: string
{
    case Pending = 'pending';
    case Accepted = 'accepted';
    case Expired = 'expired';
    case Cancelled = 'cancelled';
}

enum OnboardingStepType: string
{
    case Profile = 'profile';
    case Document = 'document';
    case Upload = 'upload';
    case Training = 'training';
    case Custom = 'custom';
}

enum OnboardingStepStatus: string
{
    case Pending = 'pending';
    case Completed = 'completed';
    case Skipped = 'skipped';
}
```

## Bulk Import CSV Format

```csv
email,name,role,department
john@example.com,John Smith,Server,Kitchen
jane@example.com,Jane Doe,Host,Front of House
```

## Tests

Expected tests in `tests/Feature/InvitationTest.php`:

1. `test_admin_can_send_invitation`
2. `test_invitation_email_is_sent`
3. `test_invitation_token_is_unique`
4. `test_invitation_expires_after_configured_time`
5. `test_user_can_accept_valid_invitation`
6. `test_user_cannot_accept_expired_invitation`
7. `test_admin_can_resend_invitation`
8. `test_admin_can_cancel_invitation`
9. `test_bulk_import_creates_invitations`
10. `test_onboarding_checklist_created_on_acceptance`
11. `test_user_can_complete_onboarding_step`
12. `test_onboarding_progress_tracked`
13. `test_admin_notified_on_onboarding_completion`

## Dependencies

- Tenant model
- User model
- BusinessRole model
- Laravel Excel for CSV import
- Mail system
