# Feature 1.1: Shift Swap Views

**Status:** Completed
**Effort:** Small
**Phase:** 1 - Core Features

## Overview

The backend for shift swaps was complete but views were missing. This feature adds the user interface for employees to view, create, and manage shift swap requests.

## Requirements

### Functional Requirements
- Employees can view all their swap requests (sent and received)
- Employees can filter swap requests by status (All, Pending, Accepted, Rejected)
- Employees can create new swap requests for their own shifts
- Employees can only swap shifts with users who have the same business role
- Employees can give away a shift without receiving one back
- Admins can view all swap requests in the organization
- Admins can approve accepted swap requests

### Business Rules
- Only the shift owner can request a swap for that shift
- Target user must have the same business role as the shift
- Target shift (if provided) must belong to the target user
- Target shift must have the same business role
- Swap requests require target employee acceptance before admin approval

## Files

### Created/Modified
- `app/Http/Controllers/ShiftSwapController.php` - Updated with status filtering, validation
- `resources/views/shift-swaps/index.blade.php` - List view with tabs
- `resources/views/shift-swaps/create.blade.php` - Create swap request form
- `tests/Feature/ShiftSwapViewsTest.php` - 15 tests

### Routes
```php
Route::get('shift-swaps', [ShiftSwapController::class, 'index'])->name('shift-swaps.index');
Route::get('shift-swaps/create/{shift}', [ShiftSwapController::class, 'create'])->name('shift-swaps.create');
Route::post('shift-swaps', [ShiftSwapController::class, 'store'])->name('shift-swaps.store');
Route::post('shift-swaps/{swapRequest}/accept', [ShiftSwapController::class, 'accept'])->name('shift-swaps.accept');
Route::post('shift-swaps/{swapRequest}/reject', [ShiftSwapController::class, 'reject'])->name('shift-swaps.reject');
Route::post('shift-swaps/{swapRequest}/cancel', [ShiftSwapController::class, 'cancel'])->name('shift-swaps.cancel');
Route::post('shift-swaps/{swapRequest}/approve', [ShiftSwapController::class, 'approve'])->name('shift-swaps.approve');
```

## Tasks

- [x] Create shift swap index view with status filtering
- [x] Create shift swap create view with eligible users/shifts selection
- [x] Add navigation link to shift swaps in sidebar
- [x] Add server-side validation for same business role requirement
- [x] Support giving away shifts without receiving one back
- [x] Write tests for shift swap views (15 tests)

## Tests

All tests located in `tests/Feature/ShiftSwapViewsTest.php`:

1. `test_admin_can_view_swap_index`
2. `test_employee_can_view_swap_index`
3. `test_index_shows_status_tabs`
4. `test_index_filters_by_pending_status`
5. `test_index_filters_by_accepted_status`
6. `test_index_shows_correct_counts`
7. `test_employee_only_sees_their_own_swaps`
8. `test_employee_can_view_create_swap_form`
9. `test_create_form_shows_shift_details`
10. `test_create_form_shows_eligible_users`
11. `test_index_shows_awaiting_admin_badge_for_accepted_swaps`
12. `test_employee_can_give_away_shift_without_receiving_one_back`
13. `test_cannot_swap_to_user_without_same_business_role`
14. `test_cannot_swap_own_shift_to_someone_else`
15. `test_create_form_only_shows_users_with_same_role`

## Dependencies

- Shift model and ShiftStatus enum
- ShiftSwapRequest model and SwapRequestStatus enum
- User model with businessRoles relationship
- BusinessRole model
