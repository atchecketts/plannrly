# Feature 10.1: Advanced Analytics & Reports (Premium)

**Status:** Not Started
**Effort:** Large
**Phase:** 10 - Premium Add-On Features

## Overview

Custom report builder and advanced analytics dashboards. This premium feature allows organizations to create custom reports, analyze labor costs, and schedule automated report delivery.

## Requirements

### Functional Requirements
- Drag-and-drop report builder
- Save and share custom reports
- Labor cost trend analysis
- Schedule efficiency metrics
- Scheduled email delivery of reports
- Export to PDF, CSV, Excel

### Business Rules
- Feature gated by premium subscription
- Reports scoped to user's accessible locations/departments
- Scheduled reports respect user permissions

### Prerequisites
- Phase 1.6 (Subscription & Feature Management) must be completed

## Files

### Created/Modified
- `app/Http/Controllers/AdvancedReportController.php` - Report controller
- `app/Services/ReportBuilderService.php` - Report generation service
- `resources/views/reports/builder.blade.php` - Drag-and-drop builder UI
- `resources/views/reports/custom.blade.php` - Custom report view
- `tests/Feature/AdvancedReportsTest.php` - Feature tests

### Routes
```php
Route::middleware(['auth', 'feature:advanced-analytics'])->group(function () {
    Route::get('reports/builder', [AdvancedReportController::class, 'builder'])
        ->name('reports.builder');
    Route::post('reports/builder', [AdvancedReportController::class, 'store'])
        ->name('reports.store');
    Route::get('reports/custom/{report}', [AdvancedReportController::class, 'show'])
        ->name('reports.custom.show');
    Route::get('reports/custom/{report}/export', [AdvancedReportController::class, 'export'])
        ->name('reports.custom.export');
});
```

## Tasks

- [ ] Create ReportBuilderService
- [ ] Create AdvancedReportController
- [ ] Build drag-and-drop report builder UI
- [ ] Implement labor cost analytics
- [ ] Add scheduled report delivery
- [ ] Create export functionality (PDF, CSV, Excel)
- [ ] Add feature gate middleware to routes
- [ ] Write tests

## Tests

Tests to be created in `tests/Feature/AdvancedReportsTest.php`:

1. `test_feature_requires_premium_subscription`
2. `test_user_can_access_report_builder`
3. `test_user_can_create_custom_report`
4. `test_user_can_save_report`
5. `test_user_can_export_to_pdf`
6. `test_user_can_export_to_csv`
7. `test_user_can_export_to_excel`
8. `test_labor_cost_analytics_calculated`
9. `test_scheduled_delivery_works`
10. `test_reports_respect_user_permissions`

## Dependencies

- Feature 1.6: Subscription & Feature Management
- Shift model
- ClockEvent model
- User model
- Location/Department models

## Notes

### Report Builder Components
- Data source selector (shifts, clock events, leave, etc.)
- Column picker
- Filter builder
- Grouping options
- Chart type selector (bar, line, pie)
- Date range picker

### Export Formats
- PDF: Use DomPDF or Snappy
- CSV: Laravel Excel or native PHP
- Excel: Laravel Excel (Maatwebsite)
